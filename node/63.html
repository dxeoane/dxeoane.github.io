<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/63" />
<link rel="canonical" href="/node/63" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Crear un archivo .tar.gz  con Delphi | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"LWFj2fXQkDaqSXMFbAS-OgHnY0_G98ozlczGkP7ql_4","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-63 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="last leaf"><a href="/node/26" title="">Contacto</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Crear un archivo .tar.gz  con Delphi</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-63" class="node node-article node-promoted clearfix" about="/node/63" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Crear un archivo .tar.gz  con Delphi" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="12" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2010-11-17T00:38:04+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 11/17/2010 - 00:38</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Los archivos con la extensión .tar.gz, también conocidos como "tarball", son viejos conocidos para aquellos que están acostumbrados a trabajar con linux, ya que es uno de los formatos mas extendidos dentro de ese mundillo para intercambiar ficheros comprimidos. En realidad un tarball es un archivo TAR que posteriormente a sido comprimido con gzip.</p>
<!--break--><p>Estos dos formatos se complementan a la perfección, mientras gzip nos permite comprimir un fichero, el formato TAR nos permite almacenar dentro de un mismo fichero toda una estructura de ficheros y directorios. De esta manera si queremos comprimir todo el contenido de un directorio dentro de un solo fichero comprimido, primero tenemos que crear un fichero TAR con todos los ficheros y luego comprimir ese fichero usando gzip.</p>
<p>El código que muestro a continuación se divide en dos partes, una "unit" con el objeto TTarWriter y un ejemplo de como usarlo para crear un archivo ".tar.gz".</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">unit</span> tar<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">interface</span>
 
<span style="color: #000000; font-weight: bold;">uses</span> Windows<span style="color: #000066;">,</span> Sysutils<span style="color: #000066;">,</span> Classes<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">type</span>
  ETarError <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">class</span><span style="color: #000066;">(</span>Exception<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  ETarInvalidName <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">class</span><span style="color: #000066;">(</span>ETarError<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
 
  THEADER_POSIX_USTAR <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">packed</span> <span style="color: #000000; font-weight: bold;">record</span>
		name<span style="color: #000066;">:</span>     <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">99</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		mode<span style="color: #000066;">:</span>     <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		uid<span style="color: #000066;">:</span>      <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		gid<span style="color: #000066;">:</span>      <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		size<span style="color: #000066;">:</span>     <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">11</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		mtime<span style="color: #000066;">:</span>    <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">11</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		checksum<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		typeflag<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		linkname<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">99</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		magic<span style="color: #000066;">:</span>    <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">5</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		version<span style="color: #000066;">:</span>  <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		uname<span style="color: #000066;">:</span>    <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">31</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		gname<span style="color: #000066;">:</span>    <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">31</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		devmajor<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		devminor<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		prefix<span style="color: #000066;">:</span>   <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">154</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
		pad<span style="color: #000066;">:</span>      <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">11</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
	<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
  TTarWriter <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">class</span><span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">TObject</span><span style="color: #000066;">)</span>
  <span style="color: #000000; font-weight: bold;">private</span>
    FCRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>
    FCalcCRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">;</span>
    FDest<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span>
    FSize<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> WriteBuffer<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">const</span> Buffer<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Longint</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> CopyFrom<span style="color: #000066;">(</span>Source<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Int64</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">public</span>
    <span style="color: #000000; font-weight: bold;">constructor</span> Create<span style="color: #000066;">(</span>Dest<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> CalcCRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span> <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">destructor</span> Destroy<span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">override</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> AddDir<span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">overload</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> AddDir<span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span> Path<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">overload</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> AddFile<span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span> Filename<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> AddStream<span style="color: #000066;">(</span>AStream<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span> Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
      TypeFlag<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span> <span style="color: #000066;">=</span> <span style="color: #ff0000;">'0'</span><span style="color: #000066;">;</span> MTime<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">int64</span> <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> Pad<span style="color: #000066;">(</span>Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">property</span> CRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span> <span style="color: #000000; font-weight: bold;">read</span> FCRC32<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">property</span> Size<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span> <span style="color: #000000; font-weight: bold;">read</span> FSize<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">implementation</span>
 
<span style="color: #000000; font-weight: bold;">var</span>
  CRCTable<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">255</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> MakeCRCTable<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  c<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>
  n<span style="color: #000066;">,</span>k<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">for</span> n<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">255</span>  <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    c<span style="color: #000066;">:</span><span style="color: #000066;">=</span> n<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> k<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">7</span> <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Odd</span><span style="color: #000066;">(</span>c<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
        c<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000cc;">$edb88320</span> <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>c <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">1</span><span style="color: #000066;">)</span>
      <span style="color: #000000; font-weight: bold;">else</span>
        c<span style="color: #000066;">:</span><span style="color: #000066;">=</span> c <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">1</span><span style="color: #000066;">;</span>
    CRCTable<span style="color: #000066;">[</span>n<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> c<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">// Calcula el CRC-32</span>
<span style="color: #000000; font-weight: bold;">function</span> UpdateCRC<span style="color: #000066;">(</span>CRC<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span> Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PByte</span><span style="color: #000066;">;</span> Len<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  CRC<span style="color: #000066;">:</span><span style="color: #000066;">=</span> CRC <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #0000cc;">$ffffffff</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">while</span> Len &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    CRC<span style="color: #000066;">:</span><span style="color: #000066;">=</span> CRCTable<span style="color: #000066;">[</span><span style="color: #000066;">(</span>CRC <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000cc;">$ff</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>CRC <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">dec</span><span style="color: #000066;">(</span>Len<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> CRC <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #0000cc;">$ffffffff</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> IntToOct<span style="color: #000066;">(</span>Value<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span> Digits<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> EmptyStr<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">while</span> Value &gt; <span style="color: #0000ff;">0</span>  <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">IntToStr</span><span style="color: #000066;">(</span>Value <span style="color: #000000; font-weight: bold;">mod</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> Result<span style="color: #000066;">;</span>
    Value<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Value <span style="color: #000000; font-weight: bold;">div</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Result<span style="color: #000066;">)</span> &lt; Digits <span style="color: #000000; font-weight: bold;">do</span>
    Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #ff0000;">'0'</span> <span style="color: #000066;">+</span> Result<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">{ TTarWriter }</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">AddDir</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Todos los directorios deben terminar en "/"</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Copy</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">,</span><span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span> &lt;&gt; <span style="color: #ff0000;">'/'</span> <span style="color: #000000; font-weight: bold;">then</span>
    Name<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Name <span style="color: #000066;">+</span> <span style="color: #ff0000;">'/'</span><span style="color: #000066;">;</span>
  AddStream<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">,</span> Name<span style="color: #000066;">,</span> <span style="color: #ff0000;">'5'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">AddDir</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span> Path<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  SR<span style="color: #000066;">:</span> TSearchRec<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Copy</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">,</span><span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span> &lt;&gt; <span style="color: #ff0000;">'/'</span> <span style="color: #000000; font-weight: bold;">then</span>
    Name<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Name <span style="color: #000066;">+</span> <span style="color: #ff0000;">'/'</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Añadimos el directorio actual</span>
  AddStream<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">,</span> Name<span style="color: #000066;">,</span> <span style="color: #ff0000;">'5'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Y luego su contenido</span>
  Path<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">IncludeTrailingPAthDelimiter</span><span style="color: #000066;">(</span>Path<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">FindFirst</span><span style="color: #000066;">(</span>Path <span style="color: #000066;">+</span> <span style="color: #ff0000;">'*.*'</span><span style="color: #000066;">,</span>faAnyFile<span style="color: #000066;">,</span>SR<span style="color: #000066;">)</span> <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">repeat</span>
      <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span> &lt;&gt; <span style="color: #ff0000;">'.'</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #000066;">(</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span> &lt;&gt; <span style="color: #ff0000;">'..'</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #000000; font-weight: bold;">begin</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Attr</span> <span style="color: #000000; font-weight: bold;">and</span> faDirectory<span style="color: #000066;">)</span> <span style="color: #000066;">=</span> faDirectory <span style="color: #000000; font-weight: bold;">then</span>
          AddDir<span style="color: #000066;">(</span>Name<span style="color: #000066;">+</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span><span style="color: #000066;">,</span>Path<span style="color: #000066;">+</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span><span style="color: #000066;">)</span>
        <span style="color: #000000; font-weight: bold;">else</span>
          AddFile<span style="color: #000066;">(</span>Name<span style="color: #000066;">+</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span><span style="color: #000066;">,</span>Path<span style="color: #000066;">+</span>SR<span style="color: #000066;">.</span><span style="color: #006600;">Name</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">until</span> <span style="color: #000066;">FindNext</span><span style="color: #000066;">(</span>SR<span style="color: #000066;">)</span>&lt;&gt;<span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">AddFile</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span> Filename<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Stream<span style="color: #000066;">:</span> TFileStream<span style="color: #000066;">;</span>
  FTime<span style="color: #000066;">:</span> FILETIME<span style="color: #000066;">;</span>
  MTime<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Stream<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>Filename<span style="color: #000066;">,</span>fmOpenRead <span style="color: #000000; font-weight: bold;">or</span> fmShareDenyWrite<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #000000; font-weight: bold;">if</span> GetFileTime<span style="color: #000066;">(</span>Stream<span style="color: #000066;">.</span><span style="color: #006600;">Handle</span><span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span><span style="color: #000066;">@</span>FTime<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #808080; font-style: italic;">// FILETIME -&gt; UNIX</span>
      MTime<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">(</span>FTime<span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">(</span><span style="color: #0000ff;">116444736000000000</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">div</span> <span style="color: #0000ff;">10000000</span>
    <span style="color: #000000; font-weight: bold;">else</span>
      MTime<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
    AddStream<span style="color: #000066;">(</span>Stream<span style="color: #000066;">,</span> Stream<span style="color: #000066;">.</span><span style="color: #006600;">Size</span><span style="color: #000066;">,</span> Name<span style="color: #000066;">,</span> <span style="color: #ff0000;">'0'</span><span style="color: #000066;">,</span> MTime<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    Stream<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">AddStream</span><span style="color: #000066;">(</span>AStream<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span> Name<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
  TypeFlag<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span> <span style="color: #000066;">=</span> <span style="color: #ff0000;">'0'</span><span style="color: #000066;">;</span> MTime<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">int64</span> <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Header<span style="color: #000066;">:</span> THEADER_POSIX_USTAR<span style="color: #000066;">;</span>
  i<span style="color: #000066;">,</span>j<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  P<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PByte</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Rellenemos la cabecera</span>
  <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Si el nombre es demasiado largo</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span> &gt; <span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">name</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #808080; font-style: italic;">// Lo partismo en 2 partes y usamos el campos "prefix"</span>
    <span style="color: #000066;">StrLCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">High</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">downto</span> <span style="color: #000066;">Low</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">if</span> Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">=</span><span style="color: #ff0000;">'/'</span> <span style="color: #000000; font-weight: bold;">then</span>
        break
      <span style="color: #000000; font-weight: bold;">else</span>
        Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #ff0000;">#0</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">delete</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">,</span><span style="color: #000066;">StrLen</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    Header<span style="color: #000066;">.</span><span style="color: #006600;">prefix</span><span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #ff0000;">#0</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Si sigue siendo demasiado largo devolvemos un error</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span> &gt; <span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">name</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #000000; font-weight: bold;">raise</span> ETarInvalidName<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Invalid name'</span><span style="color: #000066;">)</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span> 
  <span style="color: #000066;">StrLCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">name</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>Name<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">name</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Los campos que no utilizamos los ponemos a cero</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">mode</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span><span style="color: #0000ff;">7</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">uid</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span><span style="color: #0000ff;">7</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">gid</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span><span style="color: #0000ff;">7</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Size</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">size</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">11</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Modification time</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">mtime</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span>MTime<span style="color: #000066;">,</span><span style="color: #0000ff;">11</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// El checksum se llena con el caractrer #32</span>
  <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">checksum</span><span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">checksum</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  Header<span style="color: #000066;">.</span><span style="color: #006600;">typeflag</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> TypeFlag<span style="color: #000066;">;</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">magic</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'ustar'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">version</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'00'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Calcular checksum</span>
  P<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">@</span>Header<span style="color: #000066;">;</span>
  j<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>j<span style="color: #000066;">,</span>P<span style="color: #000066;">^</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>P<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">StrCopy</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">.</span><span style="color: #006600;">checksum</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>IntToOct<span style="color: #000066;">(</span>j<span style="color: #000066;">,</span><span style="color: #0000ff;">7</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Escribimos la cabecera</span>
  WriteBuffer<span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Escribimos los datos del fichero</span>
  <span style="color: #000000; font-weight: bold;">if</span> AStream &lt;&gt; <span style="color: #000000; font-weight: bold;">nil</span> <span style="color: #000000; font-weight: bold;">then</span>
    CopyFrom<span style="color: #000066;">(</span>AStream<span style="color: #000066;">,</span>Count<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Completamos el bloque</span>
  Pad<span style="color: #000066;">(</span><span style="color: #0000ff;">512</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">CopyFrom</span><span style="color: #000066;">(</span>Source<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Int64</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">const</span>
  MaxBufferSize <span style="color: #000066;">=</span> <span style="color: #0000cc;">$F000</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">;</span>
  BufferSize<span style="color: #000066;">,</span> n<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> Count &gt; MaxBufferSize <span style="color: #000000; font-weight: bold;">then</span>
    BufferSize<span style="color: #000066;">:</span><span style="color: #000066;">=</span> MaxBufferSize
  <span style="color: #000000; font-weight: bold;">else</span> BufferSize<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Count<span style="color: #000066;">;</span>
  <span style="color: #000066;">GetMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span> BufferSize<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #000000; font-weight: bold;">while</span> Count &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #000000; font-weight: bold;">if</span> Count &gt; BufferSize <span style="color: #000000; font-weight: bold;">then</span>
        n<span style="color: #000066;">:</span><span style="color: #000066;">=</span> BufferSize
      <span style="color: #000000; font-weight: bold;">else</span>
        n<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Count<span style="color: #000066;">;</span>
      Source<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>n<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      WriteBuffer<span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>n<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">Dec</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span>n<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    <span style="color: #000066;">FreeMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span> BufferSize<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">constructor</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>Dest<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> CalcCRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span> <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">inherited</span> Create<span style="color: #000066;">;</span>
  FCalcCRC32<span style="color: #000066;">:</span><span style="color: #000066;">=</span> CalcCRC32<span style="color: #000066;">;</span>
  FDest<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Dest<span style="color: #000066;">;</span>
  FSize<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">destructor</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Destroy</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Completamos hasta un multiplo de 10Kb</span>
  Pad<span style="color: #000066;">(</span><span style="color: #0000ff;">10</span><span style="color: #000066;">*</span><span style="color: #0000ff;">1024</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">// Completa el fichero para que su tamaño sea multplo de "Count"</span>
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Pad</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  i<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  P<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PByte</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> FSize <span style="color: #000000; font-weight: bold;">mod</span> Count<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> i <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Count <span style="color: #000066;">-</span> i<span style="color: #000066;">;</span>
  <span style="color: #000066;">GetMem</span><span style="color: #000066;">(</span>P<span style="color: #000066;">,</span>i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>P<span style="color: #000066;">^</span><span style="color: #000066;">,</span>i<span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    WriteBuffer<span style="color: #000066;">(</span>P<span style="color: #000066;">^</span><span style="color: #000066;">,</span>i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    <span style="color: #000066;">FreeMem</span><span style="color: #000066;">(</span>P<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>  
 
<span style="color: #000000; font-weight: bold;">procedure</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">const</span> Buffer<span style="color: #000066;">;</span> Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  FDest<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>Count<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>FSize<span style="color: #000066;">,</span>Count<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Si queremos calcular el CRC32</span>
  <span style="color: #000000; font-weight: bold;">if</span> FCalcCRC32 <span style="color: #000000; font-weight: bold;">then</span>
    FCRC32<span style="color: #000066;">:</span><span style="color: #000066;">=</span> UpdateCRC<span style="color: #000066;">(</span>FCRC32<span style="color: #000066;">,</span><span style="color: #000066;">@</span>Buffer<span style="color: #000066;">,</span>Count<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">initialization</span>
  MakeCRCTable<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>Con la "unit" anterior crear un archivo TAR es así de sencillo:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">var</span>
  Dest<span style="color: #000066;">:</span> TFileStream<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Creamos el archivo de destino</span>
  Dest<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'E:\test.tar'</span><span style="color: #000066;">,</span>fmCreate<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #000000; font-weight: bold;">with</span> TTARWriter<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>Dest<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      <span style="color: #808080; font-style: italic;">// Añadimos un directorio completo</span>
      AddDir<span style="color: #000066;">(</span><span style="color: #ff0000;">'test'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'E:\test'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      Free<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    Dest<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>Ahora para conseguir nuestro objetivo solo nos falta comprimir el archivo TAR, y aunque podríamos crear primero el archivo en disco y luego comprimirlo, mejor vamos a crearlo y comprimirlo todo a la vez en una sola pasada, ahorrándonos mucho tiempo. Aunque como vamos a realizar todo el proceso en la memoria hemos de asegurarnos que le fichero comprimido no va a ser demasiado grande.</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">uses</span> tar<span style="color: #000066;">,</span>zlib<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">type</span>
 
  <span style="color: #808080; font-style: italic;">{
    +---+---+---+---+---+---+---+---+---+---+
    |ID1|ID2|CM |FLG|     MTIME     |XFL|OS |
    +---+---+---+---+---+---+---+---+---+---+
  }</span>
  TGZHeader <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">packed</span> <span style="color: #000000; font-weight: bold;">record</span>
    ID1<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>          <span style="color: #808080; font-style: italic;">// IDentification 1 = 31</span>
    ID2<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>          <span style="color: #808080; font-style: italic;">// IDentification 2 = 139</span>
    CM<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>           <span style="color: #808080; font-style: italic;">// Compression Method = 8</span>
    FLG<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>          <span style="color: #808080; font-style: italic;">// Flags</span>
    MTIME<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>    <span style="color: #808080; font-style: italic;">// Modification TIME</span>
    XFL<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>          <span style="color: #808080; font-style: italic;">// Extra Flags</span>
    OS<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>           <span style="color: #808080; font-style: italic;">// Operating System</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
  <span style="color: #808080; font-style: italic;">{
    +---+---+---+---+---+---+---+---+
    |     CRC32     |     ISIZE     |
    +---+---+---+---+---+---+---+---+
  }</span>
 
  TGZFooter <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">packed</span> <span style="color: #000000; font-weight: bold;">record</span>
    CRC32<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>    <span style="color: #808080; font-style: italic;">// CRC-32</span>
    ISIZE<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Cardinal</span><span style="color: #000066;">;</span>    <span style="color: #808080; font-style: italic;">// Input SIZE</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">var</span>
  GZHeader<span style="color: #000066;">:</span> TGZHeader<span style="color: #000066;">;</span>
  GZFooter<span style="color: #000066;">:</span> TGZFooter<span style="color: #000066;">;</span>
  TarWriter<span style="color: #000066;">:</span> TTarWriter<span style="color: #000066;">;</span>
  CmpStream<span style="color: #000066;">:</span> TCompressionStream<span style="color: #000066;">;</span>
  TmpStream<span style="color: #000066;">:</span> TMemoryStream<span style="color: #000066;">;</span>
  P<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">;</span>
  FTime<span style="color: #000066;">:</span> FILETIME<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Creamos un buffer temporal</span>
  TmpStream<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TMemoryStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    CmpStream<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TCompressionStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>clDefault<span style="color: #000066;">,</span>TmpStream<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      TarWriter<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TTarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>CmpStream<span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">try</span>
        <span style="color: #808080; font-style: italic;">// Insertamos los ficheros</span>
        Rellenar<span style="color: #000066;">(</span>TarWriter<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        <span style="color: #808080; font-style: italic;">// Completamos el fichero</span>
        TarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Pad</span><span style="color: #000066;">(</span><span style="color: #0000ff;">10</span><span style="color: #000066;">*</span><span style="color: #0000ff;">1024</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        <span style="color: #808080; font-style: italic;">// Guardamos el tamaño y CRC del fcihero TAR</span>
        GZFooter<span style="color: #000066;">.</span><span style="color: #006600;">CRC32</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> TarWriter<span style="color: #000066;">.</span><span style="color: #006600;">CRC32</span><span style="color: #000066;">;</span>
        GZFooter<span style="color: #000066;">.</span><span style="color: #006600;">ISIZE</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> TarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Size</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">finally</span>
        TarWriter<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      CmpStream<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Creamos el gz</span>
    <span style="color: #000000; font-weight: bold;">with</span> GZHeader <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      ID1<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">31</span><span style="color: #000066;">;</span>
      ID2<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">139</span><span style="color: #000066;">;</span>
      CM<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">;</span>
      FLG<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
      GetSystemTimeAsFileTime<span style="color: #000066;">(</span>FTime<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      MTIME<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">(</span>FTime<span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">(</span><span style="color: #0000ff;">116444736000000000</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">div</span> <span style="color: #0000ff;">10000000</span><span style="color: #000066;">;</span>
      XFL<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
      OS<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">255</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">with</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'E:\123.tar.gz'</span><span style="color: #000066;">,</span>fmCreate<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      WriteBuffer<span style="color: #000066;">(</span>GZHeader<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>GZHeader<span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      P<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TmpStream<span style="color: #000066;">.</span><span style="color: #006600;">Memory</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>P<span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      WriteBuffer<span style="color: #000066;">(</span>P<span style="color: #000066;">^</span><span style="color: #000066;">,</span>TmpStream<span style="color: #000066;">.</span><span style="color: #006600;">Size</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">6</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      WriteBuffer<span style="color: #000066;">(</span>GZFooter<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>GZFooter<span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      Free<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    TmpStream<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>Donde la función "Rellenar"  es la que se encarga de añadir ficheros al archivo TAR.</p>
<p>Por ejemplo</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">procedure</span> Rellenar<span style="color: #000066;">(</span>TarWriter<span style="color: #000066;">:</span> TTarWriter<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">with</span> TarWriter <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #808080; font-style: italic;">// Añade un directorio y todo su contenido, incluyendo subdirectorios</span>
    AddDir<span style="color: #000066;">(</span><span style="color: #ff0000;">'test'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'E:\Archivos'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Añade un directorio vacío</span>
    AddDir<span style="color: #000066;">(</span><span style="color: #ff0000;">'directorio'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Añade un fichero</span>
    AddFile<span style="color: #000066;">(</span><span style="color: #ff0000;">'1.txt'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'E:\XVI32.exe'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>El resultado es un fichero tar.gz que podemos abrir con la mayoría de los programas de compresión actuales.</p>
<p>Enlaces de interés:<br /><a href="http://en.wikipedia.org/wiki/Tar_">http://en.wikipedia.org/wiki/Tar_</a>(file_format)</p>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    <div id="comments" class="comment-wrapper">
          <h2 class="title">Comentarios</h2>
      
  <a id="comment-529"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/529#comment-529" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/529#comment-529" class="permalink" rel="bookmark">Buenas,
Pues como te</a></h3>
  
  <div class="submitted">
    <a href="/comment/529#comment-529" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-11-17T15:22:08+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://www.cadetill.com" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">cadetill (no verificado)</a> el Mié, 11/17/2010 - 15:22</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Buenas,</p>
<p>Pues como te comentaba en el anterior mensaje, es sencillamente genial :)</p>
<p>No obstante, viendo por encima esto, se me da una duda. Aunque no suelo tener la necesidad de incluir más que un sólo fichero cuando comprimo, ¿cómo lo haríamos si queremos incluir algunos ficheros de un directorio? Es decir, no incluir todos los archivos de un mismo directorio (no se si se me entiende).</p>
<p>Gracias de nuevo amigo ;)</p>
<p>Nos leemos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-530"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/530#comment-530" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/530#comment-530" class="permalink" rel="bookmark">Pues no hay problema,</a></h3>
  
  <div class="submitted">
    <a href="/comment/530#comment-530" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-11-17T16:33:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 11/17/2010 - 16:33</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/529#comment-529" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Pues no hay problema, simplemente vas escogiendo los ficheros uno a uno.</p>
<p>Siguiendo con el ejemplo anterior:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">procedure</span> Rellenar<span style="color: #000066;">(</span>TarWriter<span style="color: #000066;">:</span> TTarWriter<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">with</span> TarWriter <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #808080; font-style: italic;">// Podemos añadir archivos sueltos</span>
    AddFile<span style="color: #000066;">(</span><span style="color: #ff0000;">'archivo1.txt'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'c:\123\archivo1.txt'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    AddFile<span style="color: #000066;">(</span><span style="color: #ff0000;">'archivo2.txt'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'c:\abc\archivo2.txt'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    AddFile<span style="color: #000066;">(</span><span style="color: #ff0000;">'archivo3.txt'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'c:\xyz\text.jpg'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Crear directorios dentro del archivo TAR</span>
    AddDir<span style="color: #000066;">(</span><span style="color: #ff0000;">'test'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// o subdirectorios</span>
    AddDir<span style="color: #000066;">(</span><span style="color: #ff0000;">'test/test'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
   <span style="color: #808080; font-style: italic;">// y meter archivos en ellos</span>
    AddFile<span style="color: #000066;">(</span><span style="color: #ff0000;">'test/test/archivo4.txt'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'c:\archivo4.txt'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>    
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-532"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/532#comment-532" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/532#comment-532" class="permalink" rel="bookmark">Ah!! perfecto amigo :)
Por</a></h3>
  
  <div class="submitted">
    <a href="/comment/532#comment-532" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-11-19T18:53:39+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://www.cadetill.com" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">cadetill (no verificado)</a> el Vie, 11/19/2010 - 18:53</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/530#comment-530" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Ah!! perfecto amigo :)</p>
<p>Por cierto, mirando esa función (AddDir) con más detalle, la primera comprobación que haces para saber si contiene o no el carácter / puedes hacer simplemente:</p>
<p>Name:= IncludeTrailingPathDelimiter(Name);</p>
<p>Nuevamente gracias</p>
<p>Nos leemos </p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-533"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/533#comment-533" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/533#comment-533" class="permalink" rel="bookmark">Pues siento llevarte la</a></h3>
  
  <div class="submitted">
    <a href="/comment/533#comment-533" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-11-19T21:31:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Vie, 11/19/2010 - 21:31</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/532#comment-532" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Pues siento llevarte la contraria, pero la función "IncludeTrailingPathDelimiter" compara el ultimo carácter con la constante "PathDelim" que se define así:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;">PathDelim  <span style="color: #000066;">=</span> <span style="color: #008000; font-style: italic;">{$IFDEF MSWINDOWS} '\'; {$ELSE} '/'; {$ENDIF}</span></pre></div>
<p>Por lo tanto, en windows, compara el ultimo carácter con '\' y no con '/' que es el carácter que se utiliza en linux para separar los directorios. No he probado si reemplazando '/' por '\' funcionaria, probablemente algunos descompresores no protestarían y harían la vista gorda, pero el estándar especifica que se debe usar '/' y no '\' como separador.</p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-534"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/534#comment-534" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/534#comment-534" class="permalink" rel="bookmark">jejeje, cierto, cierto, al</a></h3>
  
  <div class="submitted">
    <a href="/comment/534#comment-534" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-11-20T13:11:28+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://www.cadetill.com" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">cadetill (no verificado)</a> el Sáb, 11/20/2010 - 13:11</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/533#comment-533" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>jejeje, cierto, cierto, al momento de responder no se por qué no me di cuenta del lado de la barra, y sí, ciertamente en Windows es \ (y es lo que haría la función).</p>
<p>En fin, suerte que te tenemos a ti ahí que estás en todo, jejeje :)</p>
<p>Nos leemos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div></div></div></div><a id="comment-588"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/588#comment-588" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/588#comment-588" class="permalink" rel="bookmark">Ya lo probé y funciona</a></h3>
  
  <div class="submitted">
    <a href="/comment/588#comment-588" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-01-15T02:56:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Ariel (no verificado)</span> el Sáb, 01/15/2011 - 02:56</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Ya lo probé y funciona perfecto... Pero me gustaría saber la otra parte, o sea, cómo descomprimir el archivo<br />
resultante desde Delphi.</p>
<p>Gracias.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-589"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/589#comment-589" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/589#comment-589" class="permalink" rel="bookmark">Descomprimir un fichero es</a></h3>
  
  <div class="submitted">
    <a href="/comment/589#comment-589" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-01-15T11:36:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Sáb, 01/15/2011 - 11:36</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/588#comment-588" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Descomprimir un fichero es mas complicado que crearlo. Cuando lo creamos nosotros elegimos que cabecera vamos a usar (existen varias versiones para el formato .tar y .gz), escogemos que partes del estándar usar y cuales ignorar, en  resumen, nosotros ponemos las normas y es el programa que lo descomprime el que se tiene que adaptar a ellas.</p>
<p>Un programa descompresor tiene que implementar TODO el estándar y estar preparado para "cualquier cosa" que le pueda llegar, y programar algo así lleva bastante mas trabajo.</p>
<p>Por otro lado, si el descompresor en el que tu piensas SOLO va a descomprimir los ficheros que tu mismo creas todo es mas sencillo, solo hay que hacer los pasos inversos que cuando lo creamos. Pero en ese caso no tiene sentido ceñirse a un formato estándar como el tar.gz puedes "inventar" uno mas simple que se ajuste a tus necesidades.</p>
<p>Por ejemplo, aquí puedes encontrar un ejemplo de como uso la librería zlib para comprimir y descomprimir una información que solo va a utilizar mi programa por lo que no necesita ajustarse a ningún formato estándar:</p>
<p><a href="http://delphi.jmrds.com/node/65">http://delphi.jmrds.com/node/65</a></p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div><a id="comment-615"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/615#comment-615" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/615#comment-615" class="permalink" rel="bookmark">Me queda una duda. Que es el</a></h3>
  
  <div class="submitted">
    <a href="/comment/615#comment-615" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-01-31T13:25:21+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Marcelo (no verificado)</span> el Lun, 01/31/2011 - 13:25</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Me queda una duda. Que es el tipo FILETIME  (FTime: FILETIME;). Podrias mostrar su declaraciòn. Muchas Gracias!.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-616"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/616#comment-616" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/616#comment-616" class="permalink" rel="bookmark">El tipo FILETIME no lo</a></h3>
  
  <div class="submitted">
    <a href="/comment/616#comment-616" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-01-31T15:04:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Lun, 01/31/2011 - 15:04</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/615#comment-615" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>El tipo FILETIME no lo declaro yo, si no Windows. Y lo hace de la siguiente manera:</p>
<p><a href="http://msdn.microsoft.com/en-us/library/ms724284">http://msdn.microsoft.com/en-us/library/ms724284</a>(v=vs.85).aspx</p>
<p>Y la gente de borland lo tradujo, en la unit "Windows", de la siguiente manera:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;">_FILETIME <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">record</span>
    dwLowDateTime<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">DWORD</span><span style="color: #000066;">;</span>
    dwHighDateTime<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">DWORD</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-617"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/617#comment-617" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/617#comment-617" class="permalink" rel="bookmark">Muchas gracias Domingo!. Muy</a></h3>
  
  <div class="submitted">
    <a href="/comment/617#comment-617" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-01-31T16:01:20+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Marcelo (no verificado)</span> el Lun, 01/31/2011 - 16:01</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/616#comment-616" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Muchas gracias Domingo!. Muy buena calidad el contenido de este blog! </p>
<p>un abrazo!</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div></div><a id="comment-709"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/709#comment-709" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/709#comment-709" class="permalink" rel="bookmark">Hola chicos, muchas gracias</a></h3>
  
  <div class="submitted">
    <a href="/comment/709#comment-709" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-06-21T18:37:00+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">alex (no verificado)</span> el Mar, 06/21/2011 - 18:37</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola chicos, muchas gracias por vuestro trabajo, es genial!!!!, he estado probando el código y para *.tar con más de 10 elementos lanza un error a la hora de descompresión. Sabéis donde podría estar el error?</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-710"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/710#comment-710" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/710#comment-710" class="permalink" rel="bookmark">¿Que error te da, y con que</a></h3>
  
  <div class="submitted">
    <a href="/comment/710#comment-710" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-06-21T21:45:29+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mar, 06/21/2011 - 21:45</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/63" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/709#comment-709" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>¿Que error te da, y con que programa descompresor?</p>
<p>Yo acabo de probar a comprimir una carpeta entera, con con mas de 200 archivos, usando la opción "AddDir", y no he tenido ningún problema en descomprimirla usando 7zip.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div>
  </div>
</article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
