<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/60" />
<link rel="canonical" href="/node/60" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Simulador de balanza | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"yVwlXSfF2UvCzVftMdg9T9baJ6L9IfkInpypmWfEDi4","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-60 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="last leaf"><a href="/node/26" title="">Contacto</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Simulador de balanza</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-60" class="node node-article node-promoted clearfix" about="/node/60" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Simulador de balanza" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="20" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2010-10-02T00:37:03+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Sáb, 10/02/2010 - 00:37</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Todos los que nos dedicamos, como yo, a pelearnos con programas para tiendas, supermercados, etc ... alguna vez hemos tenido que comunicar nuestros programas con una balanza para obtener el peso. No resulta demasiado complicado conociendo el protocolo de comunicación de la balanza, así que no voy a explicar como hacerlo. Al contrario, la siguiente aplicación es un simulador de una balanza, es decir suplanta a la balanza durante la comunicación permitiéndonos así depurar nuestros programas de venta sin tener que tener conectada ninguna balanza a nuestro PC.</p>
<!--break--><p>Para este simulador he escogido el protocolo $ (puede recibir otros nombres), que es mas simple que el mecanismo de un chupete. Para obtener el peso el PC solamente tiene que enviar el carácter $ por el puerto serie y la balanza le devuelve el peso en caracteres legibles.</p>
<p>Por ejemplo:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">PC: $
Balanza: 001.123</pre></div>
<p>Este protocolo puede variar ligeramente de una marca de balanza a otra, por ejemplo, puede usar una coma en vez de un punto para separar los decimales o puede variar el numero de dígitos. Detalles que también debemos tener en cuenta cuando estemos diseñando un el software para un modelo de balanza en concreto.</p>
<p>Al ejecutar el programa nos encontramos con una ventana como esta:</p>
<p></p><center><img src="/sites/delphi.jmrds.com/imagenes/Stories/balsim.png" /></center>
<p>Una vez que hemos seleccionado el puerto serie, solo tenemos que pulsar en el botón iniciar. Para escoger el peso se utiliza el control deslizable que se encuentra debajo del display, de este modo cuando el programa de venta solicite el peso se le enviara el valor que se encuentre ese momento en el display.</p>
<p>En este punto podemos pensar que el programa no es muy útil, o al menos un poco lioso, ya que si el simulador esta usando un puerto serie, el programa de venta tendrá que estar usando otro diferente, y para comunicarse entre ambos necesitaríamos unirlos físicamente por medio de un cable serie, lo que resultara muy engorroso. Pero otra vez la "virtualizacion" nos vuelve a resolver este problema, solo tenemos que crear un par de puertos serie virtuales interconectados entre si, conectando el programa de venta y el simulador en ambos puertos.</p>
<p>Para crear ese "par" de puertos extra yo recomiendo este software, que funciona de maravilla, es fácil de configurar y ademas es gratuito y de código abierto, no se puede pedir más.<br /><a href="http://com0com.sourceforge.net/">http://com0com.sourceforge.net/</a></p>
<p>Una vez esta un poco mas claro el funcionamiento del programa vamos a explicar un poco el código.</p>
<p>La pieza principal es la unidad "uEnlace":</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">unit</span> uEnlace<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">interface</span>
 
<span style="color: #000000; font-weight: bold;">uses</span> Windows<span style="color: #000066;">,</span> Sysutils<span style="color: #000066;">,</span> Classes<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">type</span>
  EThreadEnlace <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">class</span><span style="color: #000066;">(</span>Exception<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
 
  TThreadEnlaceEvent <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">procedure</span><span style="color: #000066;">(</span>Sender<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">TObject</span><span style="color: #000066;">;</span> Command<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">var</span> Response<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000000; font-weight: bold;">object</span><span style="color: #000066;">;</span>
 
  TThreadEnlace <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">class</span><span style="color: #000066;">(</span>TThread<span style="color: #000066;">)</span>
  <span style="color: #000000; font-weight: bold;">private</span>
    FHandle<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">THandle</span><span style="color: #000066;">;</span>
    FCommand<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
    FPort<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
    FRaw<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">;</span>
    FOnCommand<span style="color: #000066;">:</span> TThreadEnlaceEvent<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> DoOnCommand<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> Enviar<span style="color: #000066;">(</span>Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> Procesar<span style="color: #000066;">(</span>Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">protected</span>
    <span style="color: #000000; font-weight: bold;">procedure</span> Execute<span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">override</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">public</span>
    <span style="color: #000000; font-weight: bold;">constructor</span> Create<span style="color: #000066;">(</span>APort<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span> Raw<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">destructor</span> Destroy<span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">override</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">property</span> OnCommand<span style="color: #000066;">:</span> TThreadEnlaceEvent <span style="color: #000000; font-weight: bold;">read</span> FOnCommand <span style="color: #000000; font-weight: bold;">write</span> FOnCommand<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">implementation</span>
 
<span style="color: #808080; font-style: italic;">{ TThreadEnlace }</span>
 
<span style="color: #000000; font-weight: bold;">constructor</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>APort<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span> Raw<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  DCB<span style="color: #000066;">:</span> TDCB<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  FCommand<span style="color: #000066;">:</span><span style="color: #000066;">=</span> EmptyStr<span style="color: #000066;">;</span>
  FPort<span style="color: #000066;">:</span><span style="color: #000066;">=</span> APort<span style="color: #000066;">;</span>
  FRaw<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Raw<span style="color: #000066;">;</span>
  FHandle<span style="color: #000066;">:</span><span style="color: #000066;">=</span> CreateFile<span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'\\.\'</span> <span style="color: #000066;">+</span> APort<span style="color: #000066;">)</span><span style="color: #000066;">,</span> GENERIC_READ <span style="color: #000000; font-weight: bold;">or</span>
    GENERIC_WRITE<span style="color: #000066;">,</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">,</span> <span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span> OPEN_EXISTING<span style="color: #000066;">,</span> FILE_ATTRIBUTE_NORMAL<span style="color: #000066;">,</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> FHandle <span style="color: #000066;">=</span> INVALID_HANDLE_VALUE <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">raise</span> EThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Error en '</span> <span style="color: #000066;">+</span> APort<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  DCB<span style="color: #000066;">.</span><span style="color: #006600;">DCBlength</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>DCB<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000000; font-weight: bold;">not</span> GetCommState<span style="color: #000066;">(</span>FHandle<span style="color: #000066;">,</span>DCB<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">raise</span> EThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Error en '</span> <span style="color: #000066;">+</span> APort<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Aqui esta la configuracion del puerto. Se la podriamos pasar por parametros ...</span>
  <span style="color: #000000; font-weight: bold;">with</span> DCB <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    BaudRate <span style="color: #000066;">:</span><span style="color: #000066;">=</span> CBR_9600<span style="color: #000066;">;</span>
    ByteSize <span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">;</span>
    Parity   <span style="color: #000066;">:</span><span style="color: #000066;">=</span> NOPARITY<span style="color: #000066;">;</span>
    StopBits <span style="color: #000066;">:</span><span style="color: #000066;">=</span> ONESTOPBIT<span style="color: #000066;">;</span>
    Flags    <span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000cc;">$01</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000000; font-weight: bold;">not</span> SetCommState<span style="color: #000066;">(</span>FHandle<span style="color: #000066;">,</span> DCB<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">raise</span> EThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Error en '</span> <span style="color: #000066;">+</span> APort<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">inherited</span> Create<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">destructor</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Destroy</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> FHandle &lt;&gt; INVALID_HANDLE_VALUE <span style="color: #000000; font-weight: bold;">then</span>
    CloseHandle<span style="color: #000066;">(</span>FHandle<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">inherited</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">DoOnCommand</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Assigned</span><span style="color: #000066;">(</span>FOnCommand<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> EmptyStr<span style="color: #000066;">;</span>
    FOnCommand<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">Self</span><span style="color: #000066;">,</span>FCommand<span style="color: #000066;">,</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span> Str &lt;&gt; EmptyStr <span style="color: #000000; font-weight: bold;">then</span>
      Enviar<span style="color: #000066;">(</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">const</span>
  CR <span style="color: #000066;">=</span> <span style="color: #ff0000;">#13</span><span style="color: #000066;">;</span>
  LF <span style="color: #000066;">=</span> <span style="color: #ff0000;">#10</span><span style="color: #000066;">;</span>
  BUFFERSIZE <span style="color: #000066;">=</span> <span style="color: #0000ff;">1024</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Enviar</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> FHandle &lt;&gt; INVALID_HANDLE_VALUE <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000066;">FileWrite</span><span style="color: #000066;">(</span>FHandle<span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Execute</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Err<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">DWORD</span><span style="color: #000066;">;</span>
  COMSTAT<span style="color: #000066;">:</span> TCOMSTAT<span style="color: #000066;">;</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">;</span>
  Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
  i<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000066;">Getmem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>BUFFERSIZE<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> EmptyStr<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #000000; font-weight: bold;">not</span> Terminated <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">if</span> ClearCommError<span style="color: #000066;">(</span>FHandle<span style="color: #000066;">,</span>Err<span style="color: #000066;">,</span><span style="color: #000066;">@</span>COMSTAT<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
        <span style="color: #000000; font-weight: bold;">if</span> COMSTAT<span style="color: #000066;">.</span><span style="color: #006600;">cbInQue</span> &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
        <span style="color: #000000; font-weight: bold;">begin</span>
          <span style="color: #000000; font-weight: bold;">if</span> COMSTAT<span style="color: #000066;">.</span><span style="color: #006600;">cbInQue</span> &gt;<span style="color: #000066;">=</span> BUFFERSIZE <span style="color: #000000; font-weight: bold;">then</span>
            Err<span style="color: #000066;">:</span><span style="color: #000066;">=</span> BUFFERSIZE <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span>
          <span style="color: #000000; font-weight: bold;">else</span>
            Err<span style="color: #000066;">:</span><span style="color: #000066;">=</span> COMSTAT<span style="color: #000066;">.</span><span style="color: #006600;">cbInQue</span><span style="color: #000066;">;</span>
          <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>BUFFERSIZE<span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          <span style="color: #000000; font-weight: bold;">if</span> ReadFile<span style="color: #000066;">(</span>FHandle<span style="color: #000066;">,</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>Err<span style="color: #000066;">,</span>Err<span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
          <span style="color: #000000; font-weight: bold;">begin</span>
            Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Str <span style="color: #000066;">+</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">if</span> FRaw <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #000000; font-weight: bold;">begin</span>
              Procesar<span style="color: #000066;">(</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> EmptyStr<span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
            <span style="color: #000000; font-weight: bold;">begin</span>
              i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Pos</span><span style="color: #000066;">(</span>CR<span style="color: #000066;">,</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              <span style="color: #000000; font-weight: bold;">while</span> i &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">do</span>
              <span style="color: #000000; font-weight: bold;">begin</span>
                Procesar<span style="color: #000066;">(</span><span style="color: #000066;">Trim</span><span style="color: #000066;">(</span><span style="color: #000066;">Copy</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">,</span>i<span style="color: #000066;">-</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                <span style="color: #000066;">Delete</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">,</span>i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Pos</span><span style="color: #000066;">(</span>CR<span style="color: #000066;">,</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
          <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
          <span style="color: #000000; font-weight: bold;">begin</span>
            <span style="color: #808080; font-style: italic;">// Aqui podemos guardar un error en el log</span>
          <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
          <span style="color: #000066;">Sleep</span><span style="color: #000066;">(</span><span style="color: #0000ff;">10</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    <span style="color: #000066;">FreeMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> TThreadEnlace<span style="color: #000066;">.</span><span style="color: #006600;">Procesar</span><span style="color: #000066;">(</span>Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  FCommand<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Str<span style="color: #000066;">;</span>
  Synchronize<span style="color: #000066;">(</span>DoOnCommand<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>Esta es una unit que desarrolle hace algún tiempo para otro proyecto, y que basicamente permite enviar y recibir comandos por el puerto serie en paralelo con el hilo principal de la aplicación, de esta manera no se queda congelada esperando datos. Tiene dos modos de funcionamiento, el normal y "RAW". En el modo normal los datos se reciben en lineas de texto terminadas por un carácter separador, en este caso CR (Carriage return), y los datos no se procesan hasta que se recibe una linea completa. En cambio en el modo RAW, el que utilizamos en esta aplicación, los datos se procesa según van llegando al puerto serie.</p>
<p>Dentro de esta unit encontramos la clase TThreadEnlace que es la que se encarga de manejar el puerto serie. Esta clase tiene un evento llamado "OnCommand" que se ejecuta cada vez que se reciben datos por el puerto serie, asi que practicamente hace todo el trabajo, nosotros solo tenemos que añadir un poco de codigo a este evento para crear nuestro programa:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">procedure</span> TfrmMain<span style="color: #000066;">.</span><span style="color: #006600;">OnCommand</span><span style="color: #000066;">(</span>Sender<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">TObject</span><span style="color: #000066;">;</span> Command<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">var</span> Response<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Pos</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'$'</span><span style="color: #000066;">,</span>Command<span style="color: #000066;">)</span> &gt; <span style="color: #0000ff;">0</span>  <span style="color: #000000; font-weight: bold;">then</span>
    Response<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">FormatFloat</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'000.000'</span><span style="color: #000066;">,</span>tbPeso<span style="color: #000066;">.</span><span style="color: #006600;">Position</span> <span style="color: #000066;">/</span> <span style="color: #0000ff;">1000</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">#13</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>El resto del código simplemente sirve para crear y destruir la clase TThreadEnlace y para obtener los parámetros de configuración.</p>
<p>El programa y el código fuente se puede descargar <a href="/sites/delphi.jmrds.com/adjuntos/Balsim_delphi.zip">aquí</a></p>
<p>Enlaces interesantes:<br /><a href="http://com0com.sourceforge.net/">http://com0com.sourceforge.net/</a>  (Un programa imprescindible)</p>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    <div id="comments" class="comment-wrapper">
          <h2 class="title">Comentarios</h2>
      
  <a id="comment-501"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/501#comment-501" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/501#comment-501" class="permalink" rel="bookmark">Hola Domingo.
Lástima que no</a></h3>
  
  <div class="submitted">
    <a href="/comment/501#comment-501" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-10-06T10:59:30+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://neftali.clubdelphi.com" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Neftalí -Germán... (no verificado)</a> el Mié, 10/06/2010 - 10:59</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola Domingo.<br />
Lástima que no lo publicaras hace un tiempo cuando me estuve peleando con este mismo tema...  ;-)<br />
Muy interesante como siempre y muy útil.</p>
<p>Un saludo.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-502"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/502#comment-502" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/502#comment-502" class="permalink" rel="bookmark">Hola Germán,
La verdad es que</a></h3>
  
  <div class="submitted">
    <a href="/comment/502#comment-502" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-10-06T11:08:00+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 10/06/2010 - 11:08</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/501#comment-501" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola Germán,</p>
<p>La verdad es que voy publicando estas utilidades según las voy necesitando. Ahora mismo me encuentro programando un "teclado autónomo" conectado a una balanza, y me canse de tener todos los aparatos encima de mi mesa, así que conecte el teclado al puerto serie de mi ordenador y guarde todo lo demás.</p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div><a id="comment-503"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/503#comment-503" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/503#comment-503" class="permalink" rel="bookmark">Que tal Domingo
Siempre</a></h3>
  
  <div class="submitted">
    <a href="/comment/503#comment-503" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-10-07T06:33:35+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Eliseo GN (no verificado)</span> el Jue, 10/07/2010 - 06:33</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Que tal Domingo</p>
<p>Siempre interesantes tus apuntes y tus 'inventos', como dice el dicho 'la necesidad es la madre de todos los inventos'. :)</p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
<a id="comment-787"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/787#comment-787" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/787#comment-787" class="permalink" rel="bookmark">Que tal colega...</a></h3>
  
  <div class="submitted">
    <a href="/comment/787#comment-787" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-09-29T21:48:02+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://soluciones-gys.blogspot.com" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Jonathan (no verificado)</a> el Jue, 09/29/2011 - 21:48</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Que tal colega...<br />
Donde puedo descarga la balanza, solamente vi el enlace de la aplicacion de puertos virtuales</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-788"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/788#comment-788" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/788#comment-788" class="permalink" rel="bookmark">Pues donde dice:</a></h3>
  
  <div class="submitted">
    <a href="/comment/788#comment-788" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-09-29T22:24:43+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Jue, 09/29/2011 - 22:24</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/787#comment-787" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Pues donde dice:<br /><cite><br />
El programa y el código fuente se puede descargar aquí<br /></cite><br />
Pulsa donde pone "aquí"</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div><a id="comment-839"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/839#comment-839" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/839#comment-839" class="permalink" rel="bookmark">Hola a todos,</a></h3>
  
  <div class="submitted">
    <a href="/comment/839#comment-839" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-01-10T18:19:29+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Alfredo (no verificado)</span> el Mar, 01/10/2012 - 18:19</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola a todos,</p>
<p>Probaron este simulador con su programa? Estoy haciendo un programa en java para recibir datos de una báscula y me es de mucha utilidad, pero no consigo recibir datos no sé pero seguro que es problema de mi programa que no hago comunicarlo bien. Aparte del simulador necesito algo más?<br />
Saludos.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-841"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/841#comment-841" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/841#comment-841" class="permalink" rel="bookmark">Si lo he probado y funciona</a></h3>
  
  <div class="submitted">
    <a href="/comment/841#comment-841" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-01-10T19:29:57+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mar, 01/10/2012 - 19:29</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/839#comment-839" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Si lo he probado y funciona bien. </p>
<p>Para probarlo, primero crea una pareja de puertos virtuales, por ejemplo COM4 y COM5. Luego abre el simulador y escoge el puerto COM4, entonces puedes utilizar el HyperTerminal si estas en Windows XP o el PuTTY si estas en Windows 7 para conectarse con el simulador usando el puerto COM5 (el otro extremo del par de puertos). Ahora solo tienes que mandar el carácter $ y te devolverá el peso.</p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-842"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/842#comment-842" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/842#comment-842" class="permalink" rel="bookmark">Se me olvidaba, el programa</a></h3>
  
  <div class="submitted">
    <a href="/comment/842#comment-842" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-01-10T19:48:45+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mar, 01/10/2012 - 19:48</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/841#comment-841" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Se me olvidaba, el programa abre el puerto serie sin "Control de flujo", si tu programa abre, por ejemplo, el puerto con control de flujo por hardware no recibirá nada porque estará esperando que mi programa le de permiso para enviar cosa que nunca sucedera.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-849"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/849#comment-849" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/849#comment-849" class="permalink" rel="bookmark">Hola, he probado su programa</a></h3>
  
  <div class="submitted">
    <a href="/comment/849#comment-849" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-01-25T11:57:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Alfredo (no verificado)</span> el Mié, 01/25/2012 - 11:57</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/842#comment-842" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola, he probado su programa con Hiperterminal y putty y funciona a la perfección! Así que le felicito por su gran trabajo.</p>
<p>Estoy haciendo un programa para enviar a través del puerto serie y recibir datos (para ejecutarlo en una báscula real también con protocolo $), estoy escribiendo un programa en c/c++ y logro escribir en el puerto pero no leer, no sé exactamente si puede ser por tema de control de flujo como indicas pero se queda esperando sin recibir nada. Parte del código es el siguiente:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">           ....
	/* abrimos el puerto */
	h=CreateFile("COM9",GENERIC_READ|GENERIC_WRITE,0,NULL,OPEN_EXISTING,0,NULL);
           ....
 
/* Configuramos el puerto */
	dcb.BaudRate = 9600;
	dcb.ByteSize = 8;
	dcb.Parity = NOPARITY;
	dcb.StopBits = ONESTOPBIT;
	dcb.fBinary = TRUE;
	dcb.fParity = TRUE;
	//CONTROL DE FLUJO.
	dcb.fOutX = FALSE;
	dcb.fInX=FALSE;
    dcb.fOutxCtsFlow= FALSE;
    dcb.fOutxDsrFlow=FALSE;
    dcb.fDtrControl = DTR_CONTROL_DISABLE;
    dcb.fRtsControl = RTS_CONTROL_DISABLE;
 
	/* Establecemos la nueva configuracion */
	if(!SetCommState(h, &amp;dcb)) {
		/* Error al configurar el puerto */
		printf("Error Nueva Configuracion");
	}
        ....
DWORD n;
		DWORD x;
		char enviar;
		char recibido;
		char *cad;
		COMSTAT cs;
		/* Enviamos... */
		enviar = '$';
		//printf("$");
		if(!WriteFile(h, &amp;enviar/*puntero al buffer*/, 1/* 1 byte*/, &amp;n, NULL)){
			/* Error al enviar */
			printf("Error al enviar");
		}
		else { printf("Enviado $\n");}
               ....
           ClearCommError (h, &amp;x, &amp;cs);
               ....
           ReadFile(h, cad, 1, &amp;x, NULL);
               ....</pre></div>
<p>Le agradecería si me pudiera ayudar.</p>
<p>Gracias!</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-850"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/850#comment-850" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/850#comment-850" class="permalink" rel="bookmark">Así, a simple vista, solo veo</a></h3>
  
  <div class="submitted">
    <a href="/comment/850#comment-850" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-01-25T13:28:13+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 01/25/2012 - 13:28</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/849#comment-849" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Así, a simple vista, solo veo "fParity=TRUE" mientras que en mi caso no utilizo paridad.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div></div></div></div><a id="comment-963"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/963#comment-963" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/963#comment-963" class="permalink" rel="bookmark">Algo me falta ya que genere</a></h3>
  
  <div class="submitted">
    <a href="/comment/963#comment-963" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-10-10T21:28:04+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Miguel (no verificado)</span> el Mié, 10/10/2012 - 21:28</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Algo me falta ya que genere los dos puertos virtuales con com0com, asigno respectivamente uno de ellos a la aplicacion y el otro mediante hyperterminal, pero cuando envio el caracter &quot;$&quot; por hyperterminal (porque me imagino que por ahi lo envian para hacer las pruebas), no recibo nada :-/</p>
<p>No se si me estara faltando algo ya que en hyperterminal seteo el puerto a 9600,8,N,1,N tal cual como se menciona aca, pero no pasa nada... me gustaria me pudiesen responder ya que trabajo con balanzas y seria de gran ayuda tener una aplicacion como esta.</p>
<p>Saludos.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-964"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/964#comment-964" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/964#comment-964" class="permalink" rel="bookmark">Prueba a abrir dos</a></h3>
  
  <div class="submitted">
    <a href="/comment/964#comment-964" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-10-10T21:59:40+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 10/10/2012 - 21:59</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/963#comment-963" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Prueba a abrir dos hyperterminal y conecta cada uno a un puerto virtual ¿lo que tecleas en uno te aparece en el otro?</p>
<p>Si es así, comprueba entonces que no estas usando "control de flujo". También prueba a cerrar todo y abrir primero el programa simulador y luego el hypertrminal. Hay veces que el puerto virtual se queda como bloqueado.</p>
<p>No se me ocurren mas motivos por los que puede fallar.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-965"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/965#comment-965" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/965#comment-965" class="permalink" rel="bookmark">Siiii... al parecer era una</a></h3>
  
  <div class="submitted">
    <a href="/comment/965#comment-965" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-10-12T14:39:22+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Miguel (no verificado)</span> el Vie, 10/12/2012 - 14:39</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/964#comment-964" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Siiii... al parecer era una cuestion de orden de apertura, probe la comunicacion entre dos hyperterminal y no hubo problema, despues abri primero el programa y luego el hyperterminal, con eso la comunicacion se establecio sin ningun problema :D</p>
<p>Muchas gracias!!!</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div></div><a id="comment-1012"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1012#comment-1012" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1012#comment-1012" class="permalink" rel="bookmark">Hola, gente</a></h3>
  
  <div class="submitted">
    <a href="/comment/1012#comment-1012" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-07-29T15:54:00+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Gabriel (no verificado)</span> el Lun, 07/29/2013 - 15:54</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola, gente<br />
Quería saber como emular las balanzas que no usan protocolo alguno, que tienen lectura continua, como puedo emular este tipo de balanzas?</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
<a id="comment-1040"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1040#comment-1040" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1040#comment-1040" class="permalink" rel="bookmark">amigo, este programa es sin</a></h3>
  
  <div class="submitted">
    <a href="/comment/1040#comment-1040" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-11-21T18:39:43+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">rod (no verificado)</span> el Jue, 11/21/2013 - 18:39</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>amigo, este programa es sin duda lo que estaba buscando, pero de verdad que no puedo hacer ese par de puertos, me he descargado el programita, y solo viene en versión DOS, pero no logro hacer que me lea los datos programo en vb6 y uso una báscula mediante com, estoy programando en una maquina sin puertos físicos, los emulo con la maquina virtual, y tu programa funciona muy bien, pero no logro obtener los datos. será posible saber como lograste crear ese par de puertos y unirlos con el programa? de antemano muchas gracias</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-1041"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/1041#comment-1041" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1041#comment-1041" class="permalink" rel="bookmark">En la pagina de sourceforge</a></h3>
  
  <div class="submitted">
    <a href="/comment/1041#comment-1041" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-11-22T00:18:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Vie, 11/22/2013 - 00:18</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/1040#comment-1040" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>En la pagina de sourceforge del proyecto "com0com" se puede descargar la versión completa del emulador de puerto serie, con interface gráfico incluido</p>
<p>Aquí la descarga directa<br /><a href="http://surfnet.dl.sourceforge.net/project/com0com/com0com/3.0.0.0/com0com-3.0.0.0-i386-and-x64-unsigned.zip">http://surfnet.dl.sourceforge.net/project/com0com/com0com/3.0.0.0/com0co...</a></p>
<p>Aquí la web de sourceforge<br /><a href="http://sourceforge.net/projects/com0com/">http://sourceforge.net/projects/com0com/</a></p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-1044"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1044#comment-1044" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1044#comment-1044" class="permalink" rel="bookmark">me tome la molestia de</a></h3>
  
  <div class="submitted">
    <a href="/comment/1044#comment-1044" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-11-27T20:50:32+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">rod (no verificado)</span> el Mié, 11/27/2013 - 20:50</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/1041#comment-1041" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>me tome la molestia de preguntarte, y ahora me tomo la libertad de agradecerte, si este link que me pasaste es el bueno!!!, Magnifico!!! tengo un POS que tenia sus detalles en la bascula, manejo vb6 y ps las laptops no tienen puerto serial ya ni hablar de mi mac. ESTO SIN DUDA me resuelve mucho de los problemas. Imaginaba una solucion asi pero no pense que alguien mas las padeciera. un saludote amigo. gracias</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div></div><a id="comment-1042"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1042#comment-1042" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1042#comment-1042" class="permalink" rel="bookmark">Gracias por e simulador, me</a></h3>
  
  <div class="submitted">
    <a href="/comment/1042#comment-1042" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-11-25T19:04:42+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Kike (no verificado)</span> el Lun, 11/25/2013 - 19:04</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Gracias por el simulador, me funciona muy bien.<br />
Ahora estoy haciendo unas pruebas desde java con la librería RXTXcomm, pero al momento de abrir el puerto me pide &quot;nombre de propietario&quot;, no se que ponerle :S</p>
<p>Se puede realizar esto?</p>
<p>Gracias de antemano.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-1043"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/1043#comment-1043" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1043#comment-1043" class="permalink" rel="bookmark">Lo siento, pero no conozco es</a></h3>
  
  <div class="submitted">
    <a href="/comment/1043#comment-1043" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-11-25T19:29:48+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Lun, 11/25/2013 - 19:29</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/1042#comment-1042" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Lo siento, pero no conozco es librería, así que no puedo ayudarte. De todos modos me resulta extraño que te pida un "nombre de propietario", no tengo ni idea de a que se puede estar refiriendo.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div><a id="comment-1073"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1073#comment-1073" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1073#comment-1073" class="permalink" rel="bookmark">Igual que Gabriel,</a></h3>
  
  <div class="submitted">
    <a href="/comment/1073#comment-1073" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2014-04-24T00:25:30+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Benjamin (no verificado)</span> el Jue, 04/24/2014 - 00:25</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/60" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Igual que Gabriel,<br />
Quería saber como emular las balanzas que no usan protocolo (Ej. $) , y que tienen lectura continua, necesito emular este tipo de balanzas</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

  </div>
</article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
