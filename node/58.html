<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/58" />
<link rel="canonical" href="/node/58" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Recibir mensajes por UDP | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.5/css/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="//cdn.jsdelivr.net/bootstrap/3.3.5/js/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"0ys_Ja_nEBA5VXospMY3k6NjrX4sdYqHLEAlziRNO4U","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-58 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="leaf"><a href="/search/node" title="">Buscar</a></li>
<li class="leaf"><a href="/rss.xml" title="">RSS</a></li>
<li class="leaf"><a href="/node/26" title="">Contacto</a></li>
<li class="last leaf"><a href="/user/login" title="">Login</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Recibir mensajes por UDP</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-58" class="node node-article node-promoted clearfix" about="/node/58" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Recibir mensajes por UDP" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="0" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2010-09-03T23:57:02+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Vie, 09/03/2010 - 23:57</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>El siguiente ejemplo muestra como recibir mensajes a través de la red usando el protocolo <a href="http://es.wikipedia.org/wiki/User_Datagram_Protocol">UDP</a>. Su funcionamiento es muy simple, una vez que se ejecuta se mantiene a la espera de recibir un paquete UDP por alguno de los puertos en los que escucha. Cuando recibe un mensaje lo muestra por pantalla, tanto en hexadecimal como en forma de texto.</p>
<!--break--><p>El código es el siguiente (es una aplicación de consola):</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">program</span> udp<span style="color: #000066;">;</span>
 
<span style="color: #008000; font-style: italic;">{$APPTYPE CONSOLE}</span>
 
 
<span style="color: #000000; font-weight: bold;">uses</span>
  Windows<span style="color: #000066;">,</span> SysUtils<span style="color: #000066;">,</span> Winsock<span style="color: #000066;">;</span>
 
 
<span style="color: #000000; font-weight: bold;">const</span>
  START_PORT <span style="color: #000066;">=</span> <span style="color: #0000ff;">5000</span><span style="color: #000066;">;</span>
  END_PORT <span style="color: #000066;">=</span> <span style="color: #0000ff;">5005</span><span style="color: #000066;">;</span>
  BUFFER_SIZE <span style="color: #000066;">=</span> <span style="color: #0000ff;">64</span><span style="color: #000066;">*</span><span style="color: #0000ff;">1024</span><span style="color: #000066;">;</span>  <span style="color: #808080; font-style: italic;">// 64 Kb</span>
 
<span style="color: #000000; font-weight: bold;">var</span>
  Terminar<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">;</span>
  WSAData<span style="color: #000066;">:</span> TWSAData<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> <span style="color: #000066;">Min</span><span style="color: #000066;">(</span>i<span style="color: #000066;">,</span>j<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> i &lt; j <span style="color: #000000; font-weight: bold;">then</span>
    Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> i
  <span style="color: #000000; font-weight: bold;">else</span>
    Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> j<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">// Muestra el mensage en hexadecimal y como texto</span>
<span style="color: #000000; font-weight: bold;">procedure</span> WriteHex<span style="color: #000066;">(</span>Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">;</span>  Count<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  i<span style="color: #000066;">,</span>j<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  j<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">while</span> Count &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #000066;">IntToHex</span><span style="color: #000066;">(</span>j<span style="color: #000066;">,</span><span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">':'</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">#32</span><span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">Min</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #000066;">IntToHex</span><span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">8</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">Min</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #000066;">IntToHex</span><span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Min</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">15</span> <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #ff0000;">#32</span><span style="color: #ff0000;">#32</span><span style="color: #ff0000;">#32</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #ff0000;">#32</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">'|'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">Min</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066; font-weight: bold;">Char</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000066;">[</span><span style="color: #ff0000;">'A'</span><span style="color: #000066;">..</span><span style="color: #ff0000;">'Z'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'a'</span><span style="color: #000066;">..</span><span style="color: #ff0000;">'z'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'0'</span><span style="color: #000066;">..</span><span style="color: #ff0000;">'9'</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span>
    <span style="color: #000000; font-weight: bold;">else</span>
      <span style="color: #000000; font-weight: bold;">Write</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'.'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'|'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">Dec</span><span style="color: #000066;">(</span>Count<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>j<span style="color: #000066;">,</span><span style="color: #0000ff;">16</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> Loop<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  i<span style="color: #000066;">,</span>j<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  b<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">;</span>
  Addr<span style="color: #000066;">:</span> TSockaddr<span style="color: #000066;">;</span>
  AddrSize<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  FDSet<span style="color: #000066;">:</span> TFDSet<span style="color: #000066;">;</span>
  TimeVal<span style="color: #000066;">:</span> TTimeVal<span style="color: #000066;">;</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">;</span>
  Sockets<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span>START_PORT<span style="color: #000066;">..</span><span style="color: #006600;">END_PORT</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">OF</span> TSocket<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Si el puerto de inicio es mayor que el final terminamos</span>
  <span style="color: #000000; font-weight: bold;">if</span> START_PORT &gt; END_PORT <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Creamos un socket por cada puerto</span>
  <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> START_PORT <span style="color: #000000; font-weight: bold;">to</span> END_PORT <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> Winsock<span style="color: #000066;">.</span><span style="color: #006600;">Socket</span><span style="color: #000066;">(</span>AF_INET<span style="color: #000066;">,</span> SOCK_DGRAM<span style="color: #000066;">,</span> IPPROTO_IP<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span> Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span> &lt;&gt; INVALID_SOCKET <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #000000; font-weight: bold;">with</span> Addr <span style="color: #000000; font-weight: bold;">do</span>
      <span style="color: #000000; font-weight: bold;">begin</span>
        sin_family<span style="color: #000066;">:</span><span style="color: #000066;">=</span> AF_INET<span style="color: #000066;">;</span>
        sin_port<span style="color: #000066;">:</span><span style="color: #000066;">=</span> htons<span style="color: #000066;">(</span>i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        sin_addr<span style="color: #000066;">.</span><span style="color: #006600;">s_addr</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> Inet_Addr<span style="color: #000066;">(</span><span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'0.0.0.0'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Ponemos cada socket a escuhar en el puerto correspondiente</span>
      <span style="color: #000000; font-weight: bold;">if</span> Bind<span style="color: #000066;">(</span>Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">,</span> Addr<span style="color: #000066;">,</span> <span style="color: #000066;">SizeOf</span><span style="color: #000066;">(</span>Addr<span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000066;">=</span> SOCKET_ERROR <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #000000; font-weight: bold;">begin</span>
        <span style="color: #808080; font-style: italic;">// Si no podemos cerramos el socket</span>
        CloseSocket<span style="color: #000066;">(</span>Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> INVALID_SOCKET<span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
        b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Si no pudimos poner a la escucha ningun socket terminamos</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000000; font-weight: bold;">not</span> b <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Reservamos espacio para almacenar los mensajes</span>
  <span style="color: #000066;">GetMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>BUFFER_SIZE<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #808080; font-style: italic;">// Mientras no pulsamos "Ctrl+C"</span>
    <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #000000; font-weight: bold;">not</span> Terminar <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #808080; font-style: italic;">// Para cada socket</span>
      <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> START_PORT <span style="color: #000000; font-weight: bold;">to</span> END_PORT <span style="color: #000000; font-weight: bold;">do</span>
        <span style="color: #000000; font-weight: bold;">if</span> Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span> &lt;&gt; INVALID_SOCKET <span style="color: #000000; font-weight: bold;">then</span>
        <span style="color: #000000; font-weight: bold;">begin</span>
          TimeVal<span style="color: #000066;">.</span><span style="color: #006600;">tv_sec</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
          TimeVal<span style="color: #000066;">.</span><span style="color: #006600;">tv_usec</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">500</span><span style="color: #000066;">;</span>
          FD_ZERO<span style="color: #000066;">(</span>FDSet<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          FD_SET<span style="color: #000066;">(</span>Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">,</span> FDSet<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          <span style="color: #808080; font-style: italic;">// Comprobamos si ha recibido algun mensaje</span>
          <span style="color: #000000; font-weight: bold;">if</span> Select<span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span> <span style="color: #000066;">@</span>FDSet<span style="color: #000066;">,</span> <span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span> <span style="color: #000000; font-weight: bold;">nil</span><span style="color: #000066;">,</span> <span style="color: #000066;">@</span>TimeVal<span style="color: #000066;">)</span> &gt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
          <span style="color: #000000; font-weight: bold;">begin</span>
            AddrSize<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Addr<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
            <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>BUFFER_SIZE<span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
            <span style="color: #808080; font-style: italic;">// Copiamos el mensaje en el buffer</span>
            j<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Recvfrom<span style="color: #000066;">(</span>Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">,</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>BUFFER_SIZE<span style="color: #000066;">,</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span>sockaddr_in<span style="color: #000066;">(</span>Addr<span style="color: #000066;">)</span><span style="color: #000066;">,</span>AddrSize<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">if</span> j &lt;&gt; SOCKET_ERROR <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #000000; font-weight: bold;">begin</span>
              <span style="color: #808080; font-style: italic;">// Imprimimos el mensaje</span>
              <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Puerto: '</span> <span style="color: #000066;">+</span> <span style="color: #000066;">IntToStr</span><span style="color: #000066;">(</span>i<span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #ff0000;">' IP: '</span> <span style="color: #000066;">+</span> inet_ntoa<span style="color: #000066;">(</span>Addr<span style="color: #000066;">.</span><span style="color: #006600;">sin_addr</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              writeln<span style="color: #000066;">;</span>
              WriteHex<span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>j<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              Writeln<span style="color: #000066;">;</span>
              Writeln<span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
          <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">Sleep</span><span style="color: #000066;">(</span><span style="color: #0000ff;">10</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    <span style="color: #000066;">FreeMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Cerramos cada uno de los socket</span>
  <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> START_PORT <span style="color: #000000; font-weight: bold;">to</span> END_PORT <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000000; font-weight: bold;">if</span> Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span> &lt;&gt; INVALID_SOCKET <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
     CloseSocket<span style="color: #000066;">(</span>Sockets<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
 
<span style="color: #808080; font-style: italic;">// Esta rutina maneja la señal "Ctrl+C"</span>
<span style="color: #000000; font-weight: bold;">function</span> HandlerRoutine<span style="color: #000066;">(</span>dwCtrlType<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">DWORD</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">BOOL</span><span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">stdcall</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">case</span> dwCtrlType <span style="color: #000000; font-weight: bold;">of</span>
    CTRL_C_EVENT<span style="color: #000066;">:</span>
      Terminar<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
    CTRL_CLOSE_EVENT<span style="color: #000066;">:</span>
      Terminar<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
    CTRL_LOGOFF_EVENT<span style="color: #000066;">:</span>
      Terminar<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
    CTRL_SHUTDOWN_EVENT<span style="color: #000066;">:</span>
      Terminar<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">else</span>
      Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">begin</span>
  Terminar<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> SetConsoleCtrlHandler<span style="color: #000066;">(</span><span style="color: #000066;">@</span>HandlerRoutine<span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Pulsa Ctrl+C para salir ...'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    Writeln<span style="color: #000066;">;</span>
    <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>WSAData<span style="color: #000066;">,</span><span style="color: #000066;">SizeOf</span><span style="color: #000066;">(</span>WSAData<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span> WSAStartup<span style="color: #000066;">(</span>MAKEWORD<span style="color: #000066;">(</span><span style="color: #0000ff;">1</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span> WSADATA<span style="color: #000066;">)</span> <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      Loop<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      WSACleanup<span style="color: #000066;">(</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  Writeln<span style="color: #000066;">;</span>
  <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Adios!'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>Para probarlo podemos usar cualquier porgrama que permita enviar paquetes UDP. </p>
<p>Yo recomiendo <a href="http://nmap.org/ncat/">ncat</a></p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">ncat -u localhost 5001</pre></div>
<p>Si usando el programa anterior enviamos un mensaje con la palabra "PRUEBA" repetida varias veces, obtenemos lo siguiente por pantalla:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">Pulsa Ctrl+C para salir ...
 
Puerto: 5001 IP: 127.0.0.1
 
00000000:  50 52 55 45 42 41 20 50  52 55 45 42 41 20 50 52  |PRUEBA.PRUEBA.PR|
00000010:  55 45 42 41 20 50 52 55  45 42 41 20 50 52 55 45  |UEBA.PRUEBA.PRUE|
00000020:  42 41 20 50 52 55 45 42  41 20 50 52 55 45 42 41  |BA.PRUEBA.PRUEBA|
00000030:  20 50 52 55 45 42 41 20  50 52 55 45 42 41 20 50  |.PRUEBA.PRUEBA.P|
00000040:  52 55 45 42 41 20 50 52  55 45 42 41 20 50 52 55  |RUEBA.PRUEBA.PRU|
00000050:  45 42 41 20 50 52 55 45  42 41 20 50 52 55 45 42  |EBA.PRUEBA.PRUEB|
00000060:  41 20 50 52 55 45 42 41  20 50 52 55 45 42 41 0A  |A.PRUEBA.PRUEBA.|</pre></div>
<p>Enlaces de interés:<br /><a href="http://es.wikipedia.org/wiki/User_Datagram_Protocol">http://es.wikipedia.org/wiki/User_Datagram_Protocol</a><br /><a href="http://nmap.org/ncat/">http://nmap.org/ncat/</a></p>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    </article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <footer class="footer container">
      <div class="region region-footer">
    <section id="block-menu-menu-enlaces" class="block block-menu clearfix">

        <h2 class="block-title">Enlaces interesantes</h2>
    
  <ul class="menu nav"><li class="first leaf"><a href="http://www.cadetill.com" title="">Cadetill</a></li>
<li class="leaf"><a href="http://www.delphiaccess.com/forum" title="">DelphiAccess</a></li>
<li class="leaf"><a href="http://www.delphispano.com/" title="">Delphispano</a></li>
<li class="leaf"><a href="http://egostar.delphiaccess.com/" title="">Egostar</a></li>
<li class="leaf"><a href="http://jachguate.wordpress.com/" title="">Jachguate</a></li>
<li class="leaf"><a href="http://neftali.clubdelphi.com/" title="">Neftali</a></li>
<li class="leaf"><a href="http://elpoli.delphiaccess.com/" title="">Poliburro</a></li>
<li class="leaf"><a href="http://theroadtodelphi.wordpress.com/" title="">Rodrigo Ruz</a></li>
<li class="last leaf"><a href="http://salvador.oversistemas.com/" title="">Salvador Gomez</a></li>
</ul>
</section>
<section id="block-block-1" class="block block-block clearfix">

      
  <p>copyright (c) 2007 - 2016 Domingo Seoane</p>

</section>
  </div>
  </footer>
  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
