<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/93" />
<link rel="canonical" href="/node/93" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Cifrado PC1 ( Pukall Cipher 1 ) en Delphi | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.5/css/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="//cdn.jsdelivr.net/bootstrap/3.3.5/js/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"QEKTjcGQ6WaaK8F9P4jeOI5ORGqxLeRipm5ie8WKE2s","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-93 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="last leaf"><a href="/node/26" title="">Contacto</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Cifrado PC1 ( Pukall Cipher 1 ) en Delphi</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-93" class="node node-article node-promoted clearfix" about="/node/93" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Cifrado PC1 ( Pukall Cipher 1 ) en Delphi" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="2" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2014-02-02T22:34:39+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Dom, 02/02/2014 - 22:34</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>El cifrado PC1 no es muy conocido, al menos yo nunca había oído hablar de el hasta hace poco. Lo poco que he podido encontrar en Internet sobre el es que fue desarrollado por un tal Alexander PUKALL en el año 1991 y algo de código en C y pascal. El algoritmo tiene una longitud de clave de 128 bits (16 bytes) y tiene como particularidad que el texto cifrado esta compuesto solamente por caracteres de la 'a' a la 'p' por lo que es muy sencillo guárdalo como texto al no aparecer caracteres extraños.</p>
<!--break--><p>
No se si es un buen sistema de cifrado o no, al no encontrar mucha información al respecto en internet, mi unico interés por el viene de que una aplicación con la trabajo habitualmente guarda sus contraseña utilizando este cifrado, así que me he decidido a hacer este pequeño código para poder trabajar con esas contraseñas. </p>
<p>Si a alguien más le resulta útil que lo utilice.</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">unit</span> Pukall<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">interface</span>
 
<span style="color: #000000; font-weight: bold;">uses</span>
  SysUtils<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> Cifrar<span style="color: #000066;">(</span>Texto<span style="color: #000066;">,</span> Clave<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">function</span> Descifrar<span style="color: #000066;">(</span>Texto<span style="color: #000066;">,</span> Clave<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">implementation</span>
 
<span style="color: #000000; font-weight: bold;">type</span>
  TPukallContext <span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">record</span>
    dx<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
    si<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
    Key<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">15</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> <span style="color: #000066;">Swap</span><span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">var</span> W1<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">var</span> W2<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  W<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  W<span style="color: #000066;">:</span><span style="color: #000066;">=</span> W1<span style="color: #000066;">;</span> W1<span style="color: #000066;">:</span><span style="color: #000066;">=</span> W2<span style="color: #000066;">;</span> W2<span style="color: #000066;">:</span><span style="color: #000066;">=</span> W<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> Assemble<span style="color: #000066;">(</span><span style="color: #000000; font-weight: bold;">var</span> Context<span style="color: #000066;">:</span> TPukallContext<span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  i<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  ax<span style="color: #000066;">,</span> bx<span style="color: #000066;">,</span> cx<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
  x1a0<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000ff;">7</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">Word</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">with</span> Context <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">7</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #000000; font-weight: bold;">if</span> i <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
        x1a0<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066;">ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #000066;">ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span>
      <span style="color: #000000; font-weight: bold;">else</span>
        x1a0<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> x1a0<span style="color: #000066;">[</span>i<span style="color: #000066;">-</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span> <span style="color: #000066;">(</span> <span style="color: #000066;">ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span>i<span style="color: #000066;">*</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #000066;">ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span><span style="color: #000066;">(</span>i<span style="color: #000066;">*</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">+</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000066;">)</span><span style="color: #000066;">;</span>
 
      <span style="color: #808080; font-style: italic;">// "Code" block</span>
      dx<span style="color: #000066;">:</span><span style="color: #000066;">=</span> dx<span style="color: #000066;">+</span>i<span style="color: #000066;">;</span>
      ax<span style="color: #000066;">:</span><span style="color: #000066;">=</span> x1a0<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">;</span>
      cx<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000cc;">$015a</span><span style="color: #000066;">;</span>
      bx<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000cc;">$4e35</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">Swap</span><span style="color: #000066;">(</span>ax<span style="color: #000066;">,</span>si<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">Swap</span><span style="color: #000066;">(</span>ax<span style="color: #000066;">,</span>dx<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>ax &lt;&gt; <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
        ax<span style="color: #000066;">:</span><span style="color: #000066;">=</span> ax<span style="color: #000066;">*</span>bx<span style="color: #000066;">;</span>
      <span style="color: #000066;">Swap</span><span style="color: #000066;">(</span>ax<span style="color: #000066;">,</span>cx<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>ax &lt;&gt; <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
      <span style="color: #000000; font-weight: bold;">begin</span>
        ax<span style="color: #000066;">:</span><span style="color: #000066;">=</span> ax<span style="color: #000066;">*</span>si<span style="color: #000066;">;</span>
        <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>cx<span style="color: #000066;">,</span>ax<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">Swap</span><span style="color: #000066;">(</span>ax<span style="color: #000066;">,</span>si<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      ax<span style="color: #000066;">:</span><span style="color: #000066;">=</span> ax<span style="color: #000066;">*</span>bx<span style="color: #000066;">;</span>
      <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>dx<span style="color: #000066;">,</span>cx<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>ax<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      x1a0<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> ax<span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// End of "Code" block</span>
 
      Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Result <span style="color: #000000; font-weight: bold;">xor</span> ax <span style="color: #000000; font-weight: bold;">xor</span> dx<span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> Cifrar<span style="color: #000066;">(</span>Texto<span style="color: #000066;">,</span> Clave<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  b<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>
  i<span style="color: #000066;">,</span> j<span style="color: #000066;">,</span> k<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  Context<span style="color: #000066;">:</span> TPukallContext<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #ff0000;">''</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Si no hay nada que cifrar salimos</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">)</span> &lt; <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Inicializamos las variables</span>
  <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Context<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Context<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">with</span> Context <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #808080; font-style: italic;">// Copiamos la clave</span>
    <span style="color: #000066;">StrLCopy</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">,</span> <span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>Clave<span style="color: #000066;">)</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">16</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Para cada elemento de la cadena</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Ord</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Ciframos este byte</span>
      k<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Assemble<span style="color: #000066;">(</span>Context<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Cambiamos la clave a partir del byte antes de cifrar</span>
      <span style="color: #000000; font-weight: bold;">for</span> j<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">15</span> <span style="color: #000000; font-weight: bold;">do</span>
        Key<span style="color: #000066;">[</span>j<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">(</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span>j<span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">xor</span> b<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Guardamos el resultado</span>
      b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> b <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>k <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>k <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000cc;">$FF</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Result <span style="color: #000066;">+</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">(</span> <span style="color: #000066;">Ord</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'a'</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #000066;">(</span>b <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">4</span><span style="color: #000066;">)</span> <span style="color: #000066;">)</span>
        <span style="color: #000066;">+</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">(</span> <span style="color: #000066;">Ord</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'a'</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #000066;">(</span>b <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000cc;">$0F</span><span style="color: #000066;">)</span> <span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">function</span> Descifrar<span style="color: #000066;">(</span>Texto<span style="color: #000066;">,</span> Clave<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">AnsiString</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  b<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>
  i<span style="color: #000066;">,</span> j<span style="color: #000066;">,</span> k<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  Context<span style="color: #000066;">:</span> TPukallContext<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #ff0000;">''</span><span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Si la longitud del texto no es multiplo de 2 salimos</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">Odd</span><span style="color: #000066;">(</span><span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  <span style="color: #808080; font-style: italic;">// Inicializamos las variables</span>
  <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Context<span style="color: #000066;">,</span><span style="color: #000066;">Sizeof</span><span style="color: #000066;">(</span>Context<span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">with</span> Context <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #808080; font-style: italic;">// Copiamos la clave</span>
    <span style="color: #000066;">StrLCopy</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">,</span> <span style="color: #000066; font-weight: bold;">PAnsiChar</span><span style="color: #000066;">(</span>Clave<span style="color: #000066;">)</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">16</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #808080; font-style: italic;">// Tomamos los elementos de dos en dos</span>
    <span style="color: #000000; font-weight: bold;">for</span> i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #000066;">(</span><span style="color: #000066;">Length</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">div</span> <span style="color: #0000ff;">2</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #808080; font-style: italic;">// Recomponemos el byte a partir de los caracteres</span>
      b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066;">(</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">[</span><span style="color: #000066;">(</span><span style="color: #0000ff;">2</span><span style="color: #000066;">*</span>i<span style="color: #000066;">)</span><span style="color: #000066;">+</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">-</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'a'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">4</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> <span style="color: #000066;">(</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span>Texto<span style="color: #000066;">[</span><span style="color: #000066;">(</span><span style="color: #0000ff;">2</span><span style="color: #000066;">*</span>i<span style="color: #000066;">)</span><span style="color: #000066;">+</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">-</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'a'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Desciframos este byte</span>
      k<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Assemble<span style="color: #000066;">(</span>Context<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      b<span style="color: #000066;">:</span><span style="color: #000066;">=</span> b <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>k <span style="color: #000000; font-weight: bold;">shr</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">xor</span> <span style="color: #000066;">(</span>k <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000cc;">$FF</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Result <span style="color: #000066;">+</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">(</span>b<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Modificamos la clave a partir del byte descifrado</span>
      <span style="color: #000000; font-weight: bold;">for</span> j<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">to</span> <span style="color: #0000ff;">15</span> <span style="color: #000000; font-weight: bold;">do</span>
        Key<span style="color: #000066;">[</span>j<span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">AnsiChar</span><span style="color: #000066;">(</span><span style="color: #000066;">Ord</span><span style="color: #000066;">(</span>Key<span style="color: #000066;">[</span>j<span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">xor</span> b<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>Ejemplo de como usarlo:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">var</span>
  Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Cifrar<span style="color: #000066;">(</span><span style="color: #ff0000;">'Hola mundo'</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'Clave'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Texto cifrado: '</span> <span style="color: #000066;">+</span> Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Descifrar<span style="color: #000066;">(</span>Str<span style="color: #000066;">,</span><span style="color: #ff0000;">'Clave'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000066;">Writeln</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Texto descifrado: '</span> <span style="color: #000066;">+</span> Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span> 
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>El ejemplo anterior da una salida como esta:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">Texto cifrado: agcjjacjmhnibkjajjgi
Texto descifrado: Hola mundo</pre></div>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    <div id="comments" class="comment-wrapper">
          <h2 class="title">Comentarios</h2>
      
  <a id="comment-1055"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1055#comment-1055" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1055#comment-1055" class="permalink" rel="bookmark">Me lo guardo :)
Saludos.</a></h3>
  
  <div class="submitted">
    <a href="/comment/1055#comment-1055" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2014-02-03T11:02:50+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">casimiro (no verificado)</span> el Lun, 02/03/2014 - 11:02</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/93" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Me lo guardo :)</p>
<p>Saludos.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
<a id="comment-1059"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1059#comment-1059" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1059#comment-1059" class="permalink" rel="bookmark">Interesante...</a></h3>
  
  <div class="submitted">
    <a href="/comment/1059#comment-1059" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2014-02-22T14:30:04+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Cañones (no verificado)</span> el Sáb, 02/22/2014 - 14:30</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/93" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Interesante...<br />
Gracias por compartirlo, tal vez lo use.<br />
Saludos.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

  </div>
</article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
