<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/56" />
<link rel="canonical" href="/node/56" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Extraer imagenes de un fichero MPO | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.5/css/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="//cdn.jsdelivr.net/bootstrap/3.3.5/js/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"Fr-KgQsFguFFCv1j0I5eRp6eK0rlSNlQX4uwnRiADFw","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-56 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="last leaf"><a href="/node/26" title="">Contacto</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Extraer imagenes de un fichero MPO</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-56" class="node node-article node-promoted clearfix" about="/node/56" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Extraer imagenes de un fichero MPO" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="5" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2010-04-21T23:00:13+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 04/21/2010 - 23:00</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Recientemente han llamado mi atención sobre el formato de imagen MPO (Multi-Picture Format), un formato que se usa dentro del campo de la fotografía en 3D, y concretamente es el utilizado por la cámara FinePix REAL 3D. Básicamente un fichero MPO esta compuesto por una imagen principal, y una serie de imágenes secundarias, guardadas en formato JPEG.  La imagen principal está colocada justo al comienzo del fichero de tal forma que podría ser vista por cualquier visor de imágenes jpeg, mientras que para ver el resto de imágenes necesitamos de algún software especifico que soporte este formato.</p>
<!--break--><p>Como decía, mi interés por este formato viene dado por una pregunta de otro programador que quería saber como extraer de un fichero MPO cada una las diferentes imágenes jpeg que lo componen. Entonces recordé  el código para recuperar imágenes jpeg que coloque por <a href="http://delphi.jmrds.com/node/42">aquí</a>, si bien ese programa estaba pensado para recuperar fotos borradas, también sirve para extraer una imagen jpeg de cualquier archivo en el que este incrustada (pdf, thumb.db, etc ...) y por lo tanto tampoco tiene ningún problema en extraer las imágenes jpeg de un fichero MPO.</p>
<p>El problema que surgió entonces fue la velocidad, el proceso era muy lento, sobre todo con imágenes grandes. Pero la solución era sencilla, cargar el fichero MPO en memoria antes de comenzar a explorarlo, esto incrementa de forma radical la velocidad de todo proceso. En el código original no se cargaba el fichero de origen en memoria porque estaba pensado para examinar discos completos, y no tiene mucho sentido cargar un fichero de varios gigas en memoria, pero cuando tratamos con ficheros de pocos megas, como es el caso de los MPO no hay problema.</p>
<p>El resultado de todo lo anterior es este pequeño programa:</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">program</span> mpo2jpg<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">uses</span>
  Windows<span style="color: #000066;">,</span> SysUtils<span style="color: #000066;">,</span> Classes<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> CopyJpegFrom<span style="color: #000066;">(</span>Src<span style="color: #000066;">,</span> Dst<span style="color: #000066;">:</span> TStream<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">PByteArray</span><span style="color: #000066;">;</span>
  Size<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000066;">GetMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span><span style="color: #0000cc;">$10000</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #000000; font-weight: bold;">TRUE</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      <span style="color: #000066;">FillChar</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">,</span><span style="color: #ff0000;">#0</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      Src<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Read</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      Size<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">3</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">2</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">case</span> Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span>
        <span style="color: #0000cc;">$01</span><span style="color: #000066;">,</span><span style="color: #0000cc;">$D0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$D8</span><span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">begin</span>
                        Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                        Src<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">2</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        <span style="color: #0000cc;">$D9</span><span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">begin</span>
               Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
               Exit<span style="color: #000066;">;</span>
             <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        <span style="color: #0000cc;">$DA</span><span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">begin</span>
               Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
               Src<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">2</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
               <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #000000; font-weight: bold;">TRUE</span> <span style="color: #000000; font-weight: bold;">do</span>
               <span style="color: #000000; font-weight: bold;">begin</span>
                 Src<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                 <span style="color: #000000; font-weight: bold;">if</span> Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span> <span style="color: #000066;">=</span> <span style="color: #0000cc;">$FF</span> <span style="color: #000000; font-weight: bold;">then</span>
                 <span style="color: #000000; font-weight: bold;">begin</span>
                   Src<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span> &lt;&gt; <span style="color: #0000ff;">0</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #000000; font-weight: bold;">not</span> <span style="color: #000066;">(</span>Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000066;">[</span><span style="color: #0000cc;">$D0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$D7</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
                   <span style="color: #000000; font-weight: bold;">begin</span>
                     Src<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">2</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                     break<span style="color: #000066;">;</span>
                   <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
                   <span style="color: #000000; font-weight: bold;">begin</span>
                     Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span><span style="color: #000066;">;</span>
                     Buffer<span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">]</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000cc;">$FF</span><span style="color: #000066;">;</span>
                     Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                   <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
                 <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
                   Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
               <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
             <span style="color: #000000; font-weight: bold;">end</span>
        <span style="color: #000000; font-weight: bold;">else</span>
        <span style="color: #000000; font-weight: bold;">begin</span>
          Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          Src<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>Size<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          Dst<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">^</span><span style="color: #000066;">,</span>Size<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    <span style="color: #000066;">FreeMem</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> SaveJpegToFile<span style="color: #000066;">(</span>Src<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> Filename<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Stream<span style="color: #000066;">:</span> TMemoryStream<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Stream<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TMemoryStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    CopyJpegFrom<span style="color: #000066;">(</span>Src<span style="color: #000066;">,</span> Stream<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    Stream<span style="color: #000066;">.</span><span style="color: #006600;">SaveToFile</span><span style="color: #000066;">(</span>Filename<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    Stream<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> ScanFile<span style="color: #000066;">(</span>Stream<span style="color: #000066;">:</span> TStream<span style="color: #000066;">;</span> FormatStr<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span> Index<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span> Full<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span> <span style="color: #000000; font-weight: bold;">overload</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  B<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Byte</span><span style="color: #000066;">;</span>
  Leidos<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  Posicion<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">int64</span><span style="color: #000066;">;</span>
  Str<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">String</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #808080; font-style: italic;">// Leemos byte a byte hasta encontrar la marca de inicio</span>
  Leidos<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Stream<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Read</span><span style="color: #000066;">(</span>B<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">while</span> Leidos <span style="color: #000066;">=</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">if</span> B <span style="color: #000066;">=</span> <span style="color: #0000cc;">$FF</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
      Leidos<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Stream<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Read</span><span style="color: #000066;">(</span>B<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">if</span> Leidos <span style="color: #000066;">=</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">then</span>
        <span style="color: #000000; font-weight: bold;">if</span> B <span style="color: #000066;">=</span> <span style="color: #0000cc;">$D8</span> <span style="color: #000000; font-weight: bold;">then</span>
        <span style="color: #000000; font-weight: bold;">begin</span>
          Leidos<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Stream<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Read</span><span style="color: #000066;">(</span>B<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
          <span style="color: #000000; font-weight: bold;">if</span> Leidos <span style="color: #000066;">=</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #000000; font-weight: bold;">if</span> B <span style="color: #000066;">=</span> <span style="color: #0000cc;">$FF</span> <span style="color: #000000; font-weight: bold;">then</span>
            <span style="color: #000000; font-weight: bold;">begin</span>
              <span style="color: #808080; font-style: italic;">// Encontramos la marca de inicio</span>
              Posicion<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Stream<span style="color: #000066;">.</span><span style="color: #006600;">Position</span><span style="color: #000066;">;</span>
              Stream<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">3</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              Str<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">Format</span><span style="color: #000066;">(</span>FormatStr<span style="color: #000066;">,</span><span style="color: #000066;">[</span>index<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              <span style="color: #000000; font-weight: bold;">try</span>
                <span style="color: #808080; font-style: italic;">// Intentamos extraer la imagen</span>
                SaveJpegToFile<span style="color: #000066;">(</span>Stream<span style="color: #000066;">,</span>Str<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>index<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
              <span style="color: #000000; font-weight: bold;">except</span>
                <span style="color: #808080; font-style: italic;">// Si se produce un error volvemos atras y continuamos buscando</span>
                <span style="color: #000000; font-weight: bold;">On</span> E<span style="color: #000066;">:</span> Exception <span style="color: #000000; font-weight: bold;">do</span>
                <span style="color: #000000; font-weight: bold;">begin</span>
                   Stream<span style="color: #000066;">.</span><span style="color: #006600;">Position</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> Posicion<span style="color: #000066;">;</span>
                <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
              <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
              <span style="color: #808080; font-style: italic;">// Si la busqueda es "completa", extraemos tambien los thumbnails</span>
              <span style="color: #000000; font-weight: bold;">if</span> Full <span style="color: #000000; font-weight: bold;">then</span>              
                Stream<span style="color: #000066;">.</span><span style="color: #006600;">Position</span><span style="color: #000066;">:</span><span style="color: #000066;">=</span> Posicion<span style="color: #000066;">;</span>
            <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span> <span style="color: #000000; font-weight: bold;">else</span>
      Leidos<span style="color: #000066;">:</span><span style="color: #000066;">=</span> Stream<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Read</span><span style="color: #000066;">(</span>B<span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">var</span>
  Src<span style="color: #000066;">:</span> TMemoryStream<span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> ParamCount <span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span> <span style="color: #000000; font-weight: bold;">then</span>
    Exit<span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    Src<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TMemoryStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      <span style="color: #808080; font-style: italic;">// Cargamos el archivo en memoria</span>
      Src<span style="color: #000066;">.</span><span style="color: #006600;">LoadFromFile</span><span style="color: #000066;">(</span><span style="color: #000066;">ParamStr</span><span style="color: #000066;">(</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #808080; font-style: italic;">// Exploramos el archivo cargado en la memoria</span>
      ScanFile<span style="color: #000066;">(</span>Src<span style="color: #000066;">,</span><span style="color: #000066;">ChangeFileExt</span><span style="color: #000066;">(</span><span style="color: #000066;">ParamStr</span><span style="color: #000066;">(</span><span style="color: #0000ff;">1</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'_%d.jpg'</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">1</span><span style="color: #000066;">,</span><span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      Src<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">except</span>
    <span style="color: #000000; font-weight: bold;">On</span> E<span style="color: #000066;">:</span> Exception <span style="color: #000000; font-weight: bold;">do</span>
    <span style="color: #000000; font-weight: bold;">begin</span>
       <span style="color: #808080; font-style: italic;">// Si tenemos algun error lo mostramos</span>
       MessageBox<span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">(</span>E<span style="color: #000066;">.</span><span style="color: #000000; font-weight: bold;">Message</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'Error'</span><span style="color: #000066;">,</span>MB_ICONERROR <span style="color: #000000; font-weight: bold;">or</span> MB_SETFOREGROUND
         <span style="color: #000000; font-weight: bold;">or</span> MB_TASKMODAL <span style="color: #000000; font-weight: bold;">or</span> MB_OK<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">.</span></pre></div>
<p>Su uso es sencillo, solo hay que pesarle como parámetro el fichero MPO (o simplemente arrastrar el fichero y soltarlo sobre el .exe)  y automáticamente el programa extraerá la imágenes en el mismo directorio del fichero original (hay que comprobar primero que ese directorio no sea de "solo lectura").</p>
<p>Por ejemplo:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">mpo2jpg ejemplo.mpo</pre></div>
<p>El programa completo, con sus fuentes, se puede bajar de <a href="/sites/delphi.jmrds.com/adjuntos/delphi_mpo2jpg.zip">aquí</a>. También se puede utilizar para extraer imágenes de ficheros pdf, thumb.db, etc ... siempre que tengan un tamaño razonable.</p>
<p>Para saber más sobre el formato MPO:<br /><a href="http://www.cipa.jp/english/hyoujunka/kikaku/pdf/DC-007_E.pdf">http://www.cipa.jp/english/hyoujunka/kikaku/pdf/DC-007_E.pdf</a></p>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    <div id="comments" class="comment-wrapper">
          <h2 class="title">Comentarios</h2>
      
  <a id="comment-414"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/414#comment-414" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/414#comment-414" class="permalink" rel="bookmark">Muchas gracias por compartir</a></h3>
  
  <div class="submitted">
    <a href="/comment/414#comment-414" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2010-08-12T12:19:34+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <a href="http://www.xavitron.net" rel="nofollow foaf:page" class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">xavitron (no verificado)</a> el Jue, 08/12/2010 - 12:19</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/56" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Muchas gracias por compartir el código fuente. Además, es un programa muy útil.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
<a id="comment-771"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/771#comment-771" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/771#comment-771" class="permalink" rel="bookmark">Hola: muchas gracias por este</a></h3>
  
  <div class="submitted">
    <a href="/comment/771#comment-771" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2011-08-28T20:34:00+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">María (no verificado)</span> el Dom, 08/28/2011 - 20:34</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/56" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Hola, muchas gracias por este programa. La cámara fuji3d está configurada de tal manera que no puedes hacer las fotos simultáneas idénticas. De esta manera no podía sacar las fotos para montarlas en un estereoscopio, o las tenía que manipular.<br />
Así que me viene fenomenal. Mil gracias.<br />
María.</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
<a id="comment-968"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/968#comment-968" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/968#comment-968" class="permalink" rel="bookmark">hola oye sabes como puedo</a></h3>
  
  <div class="submitted">
    <a href="/comment/968#comment-968" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-11-07T17:01:00+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">ANGEL MAUREL (no verificado)</span> el Mié, 11/07/2012 - 17:01</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/56" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Sabes como puedo recuperar la otra imagen, solo aparece la principal y quisiera tener las 2 (izquierdo y derecho)<br />
gracias</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-969"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/969#comment-969" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/969#comment-969" class="permalink" rel="bookmark">Pues deberían de aparecer las</a></h3>
  
  <div class="submitted">
    <a href="/comment/969#comment-969" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2012-11-07T21:28:53+01:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 11/07/2012 - 21:28</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/56" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/968#comment-968" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Pues deberían de aparecer las dos, si no aparecen es que en el fichero solo hay una imagen y no dos.</p>
<p>Saludos</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div><a id="comment-1029"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/1029#comment-1029" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a href="/comment/1029#comment-1029" class="permalink" rel="bookmark">En la página de fuji se puede</a></h3>
  
  <div class="submitted">
    <a href="/comment/1029#comment-1029" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2013-09-17T08:21:57+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">Martín de Anda (no verificado)</span> el Mar, 09/17/2013 - 08:21</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/56" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>En la página de fuji se puede descargar el programa myfinepix studio en donde se pueden crear archivos mpo y separar los existentes, el problema es que hay que hacerlo de uno por uno y es tedioso y muy lento. saludos!!!</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

  </div>
</article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
