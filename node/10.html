<!DOCTYPE html>
<html lang="es" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/delphi.jmrds.com/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="/node/10" />
<link rel="canonical" href="/node/10" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Optimizar archivo jpeg | La web de Seoane</title>
  <style>
@import url("/modules/system/system.base.css?");
</style>
<style>
@import url("/modules/field/theme/field.css?");
@import url("/modules/node/node.css?");
</style>
<style>
@import url("/sites/delphi.jmrds.com/modules/geshifilter/geshifilter.css?");
</style>
<link type="text/css" rel="stylesheet" href="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.css" media="all" />
<style>
@import url("/sites/delphi.jmrds.com/themes/bootstrap/css/3.3.5/overrides.min.css?");
</style>
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="/sites/delphi.jmrds.com/modules/jquery_update/replace/jquery/1.10/jquery.min.js?v=1.10.2"></script>
<script src="/misc/jquery.once.js?v=1.2"></script>
<script src="/misc/drupal.js?"></script>
<script src="/sites/delphi.jmrds.com/themes/bootstrap/bootstrap.js"></script>
<script src="/sites/delphi.jmrds.com/files/languages/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js?"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"gIeKJFf_PVRy7goESgab8aVJRRH1YrubfrVsWEs2tZk","js":{"sites\/delphi.jmrds.com\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/delphi.jmrds.com\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/js\/bootstrap.js":1,"public:\/\/languages\/es_sB9mP1iixuFRbyZKZVySK7xrSW_2-LRj1vNEXyqwOu8.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/delphi.jmrds.com\/modules\/geshifilter\/geshifilter.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.3.5\/css\/bootstrap.css":1,"sites\/delphi.jmrds.com\/themes\/bootstrap\/css\/3.3.5\/overrides.min.css":1}},"bootstrap":{"anchorsFix":"0","anchorsSmoothScrolling":"0","formHasError":1,"popoverEnabled":"1","popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":"1","tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-10 node-type-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Pasar al contenido principal</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="/" title="Inicio">
          <img src="/sites/delphi.jmrds.com/themes/bootstrap/logo.png" alt="Inicio" />
        </a>
      
              <a class="name navbar-brand" href="/" title="Inicio">La web de Seoane</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse" id="navbar-collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="/" title="">Inicio</a></li>
<li class="last leaf"><a href="/node/26" title="">Contacto</a></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      </header> <!-- /#page-header -->

  <div class="row">

    
    <section class="col-sm-12">
                  <a id="main-content"></a>
                    <h1 class="page-header">Optimizar archivo jpeg</h1>
                                                          <div class="region region-content">
    <section id="block-system-main" class="block block-system clearfix">

      
  <article id="node-10" class="node node-article node-promoted clearfix" about="/node/10" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Optimizar archivo jpeg" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="2" datatype="xsd:integer" class="rdf-meta element-hidden"></span>        <span class="submitted">
            <span property="dc:date dc:created" content="2007-04-11T01:01:10+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Mié, 04/11/2007 - 01:01</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Los archivos Jpeg además de la propia imagen contienen información extra añadida por algunos programas (comentarios, tipo de cámara, thumbnails, etc) que engordan el archivo pero que no son necesarios para ver la imagen.</p>
<!--break--><p>
En este truco vamos a eliminar toda esa información extra y dejar el archivo lo mas pequeño posible sin modificar en nada la calidad de la imagen. </p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">procedure</span> Limpiar<span style="color: #000066;">(</span>Origen<span style="color: #000066;">,</span> Destino<span style="color: #000066;">:</span> TStream<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$FFFF</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">Char</span><span style="color: #000066;">;</span>
  Header<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">..</span><span style="color: #0000ff;">4</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #000066;">;</span>
  Size<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Origen<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span>soFromBeginning<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  Origen<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span> &lt;&gt; <span style="color: #0000cc;">$FF</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">or</span> <span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> &lt;&gt; <span style="color: #0000cc;">$D8</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">raise</span> Exception<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Identificador incorrecto'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  Destino<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">repeat</span>
    Origen<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    Size<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">3</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> Header<span style="color: #000066;">[</span><span style="color: #0000ff;">4</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">2</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">case</span> Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span>
      <span style="color: #808080; font-style: italic;">// $FE: Origen.Seek(Size,soFromCurrent);</span>
      <span style="color: #0000cc;">$FE</span><span style="color: #000066;">,</span> <span style="color: #0000cc;">$E0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$EF</span><span style="color: #000066;">:</span> Origen<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span>Size<span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #0000cc;">$01</span><span style="color: #000066;">,</span><span style="color: #0000cc;">$D0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$D9</span><span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">begin</span>
                      Destino<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
                      Origen<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">2</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span>
                    <span style="color: #000000; font-weight: bold;">end</span>
      <span style="color: #000000; font-weight: bold;">else</span>
      <span style="color: #000000; font-weight: bold;">begin</span>
        Origen<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>Size<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        Destino<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        Destino<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>Size<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">until</span> Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> <span style="color: #000066;">=</span> <span style="color: #0000cc;">$DA</span><span style="color: #000066;">;</span>
  Destino<span style="color: #000066;">.</span><span style="color: #006600;">CopyFrom</span><span style="color: #000066;">(</span>Origen<span style="color: #000066;">,</span>Origen<span style="color: #000066;">.</span><span style="color: #006600;">Size</span> <span style="color: #000066;">-</span> Origen<span style="color: #000066;">.</span><span style="color: #006600;">Position</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">// Ejemplo de uso</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Origen<span style="color: #000066;">,</span> Destino<span style="color: #000066;">:</span> TFileStream<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  <span style="color: #000000; font-weight: bold;">if</span> OpenDialog1<span style="color: #000066;">.</span><span style="color: #006600;">Execute</span> <span style="color: #000000; font-weight: bold;">then</span>
  <span style="color: #000000; font-weight: bold;">begin</span>
    Origen<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>OpenDialog1<span style="color: #000066;">.</span><span style="color: #006600;">FileName</span><span style="color: #000066;">,</span> fmOpenRead<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      Destino<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #000066;">ChangeFileExt</span><span style="color: #000066;">(</span>OpenDialog1<span style="color: #000066;">.</span><span style="color: #006600;">FileName</span><span style="color: #000066;">,</span><span style="color: #ff0000;">'_b.jpg'</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span>fmCreate<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">try</span>
        Limpiar<span style="color: #000066;">(</span>Origen<span style="color: #000066;">,</span>Destino<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">finally</span>
        Destino<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      Origen<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span></pre></div>
<p>Esta limpieza además de ajustar el tamaño del archivo, ayuda a mantener nuestra intimidad, ya que borra también las imágenes en miniatura, conocidas como thumbnails, que algunas aplicaciones guardan dentro del archivo jpeg. Se han dado casos de programas, que al recortar la imagen, siguen manteniendo la imagen en miniatura de la imagen completa, revelando así partes de la imagen que queríamos ocultar. Una buena limpieza y problema resuelto ...</p>
<p>Ahora poniéndonos del otro lado, del lado de los curiosos, podemos pensar una manera de extraer las imágenes en miniatura de los archivos jpeg y así comprobar si alguien a cometido una indiscreción. Podríamos aplicar un método mas ortodoxo, siguiendo el formato Exif por el que se rigen este tipo de miniaturas, pero lo que vamos a hacer es extraer el segmento que contiene la información Exif, una vez lo tenemos buscamos la marca $FFD8 que indica el inicio de una imagen jpeg. Esto no es la forma mas correcta de hacerlo, ya que nos saltamos toda la estructura de datos Exif, pero el caso es que funciona  y para jugar un rato nos sirve.</p>
<div class="geshifilter">
<pre class="delphi geshifilter-delphi" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> ReadThumb<span style="color: #000066;">(</span>Source<span style="color: #000066;">,</span> Dest<span style="color: #000066;">:</span> TStream<span style="color: #000066;">)</span><span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Boolean</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Buffer<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$FFFF</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">Char</span><span style="color: #000066;">;</span>
  Header<span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">array</span><span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">..</span><span style="color: #0000ff;">4</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span> <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #000066;">;</span>
  Size<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
  i<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">Integer</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #000066;">;</span>
  Source<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #0000ff;">0</span><span style="color: #000066;">,</span>soFromBeginning<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  Source<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">1</span><span style="color: #000066;">]</span> &lt;&gt; <span style="color: #0000cc;">$FF</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">or</span> <span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> &lt;&gt; <span style="color: #0000cc;">$D8</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
    <span style="color: #000000; font-weight: bold;">raise</span> Exception<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span><span style="color: #ff0000;">'Identificador incorrecto'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">repeat</span>
    Source<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">,</span><span style="color: #0000ff;">4</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    Size<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000066;">(</span><span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">3</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">shl</span> <span style="color: #0000ff;">8</span><span style="color: #000066;">)</span> <span style="color: #000066;">+</span> Header<span style="color: #000066;">[</span><span style="color: #0000ff;">4</span><span style="color: #000066;">]</span><span style="color: #000066;">)</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">2</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">case</span> Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> <span style="color: #000000; font-weight: bold;">of</span>
      <span style="color: #0000cc;">$E1</span><span style="color: #000066;">:</span> <span style="color: #000000; font-weight: bold;">begin</span>
        Source<span style="color: #000066;">.</span><span style="color: #006600;">ReadBuffer</span><span style="color: #000066;">(</span>Buffer<span style="color: #000066;">,</span>Size<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        i<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #0000ff;">0</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">while</span> i &lt; Size <span style="color: #000066;">-</span> <span style="color: #0000ff;">1</span> <span style="color: #000000; font-weight: bold;">do</span>
        <span style="color: #000000; font-weight: bold;">begin</span>
          <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000066;">CompareMem</span><span style="color: #000066;">(</span><span style="color: #000066;">@</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">,</span><span style="color: #000066; font-weight: bold;">PChar</span><span style="color: #000066;">(</span><span style="color: #ff0000;">#$FF</span><span style="color: #ff0000;">#$D8</span><span style="color: #000066;">)</span><span style="color: #000066;">,</span><span style="color: #0000ff;">2</span><span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
          <span style="color: #000000; font-weight: bold;">begin</span>
            Dest<span style="color: #000066;">.</span><span style="color: #006600;">WriteBuffer</span><span style="color: #000066;">(</span><span style="color: #000066;">(</span><span style="color: #000066;">@</span>Buffer<span style="color: #000066;">[</span>i<span style="color: #000066;">]</span><span style="color: #000066;">)</span><span style="color: #000066;">^</span><span style="color: #000066;">,</span> Size <span style="color: #000066;">-</span> i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
            Result<span style="color: #000066;">:</span><span style="color: #000066;">=</span> <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #000066;">;</span>
            break<span style="color: #000066;">;</span>
          <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
          <span style="color: #000066;">inc</span><span style="color: #000066;">(</span>i<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
        <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
        break<span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
      <span style="color: #0000cc;">$01</span><span style="color: #000066;">,</span><span style="color: #0000cc;">$D0</span><span style="color: #000066;">..</span><span style="color: #0000cc;">$D9</span><span style="color: #000066;">:</span> Source<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span><span style="color: #000066;">-</span><span style="color: #0000ff;">2</span><span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
      <span style="color: #000000; font-weight: bold;">else</span> Source<span style="color: #000066;">.</span><span style="color: #000066;">Seek</span><span style="color: #000066;">(</span>Size<span style="color: #000066;">,</span>soFromCurrent<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">until</span> <span style="color: #000066;">(</span>Header<span style="color: #000066;">[</span><span style="color: #0000ff;">2</span><span style="color: #000066;">]</span> <span style="color: #000066;">=</span> <span style="color: #0000cc;">$DA</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #000000; font-weight: bold;">procedure</span> ExtractThumb<span style="color: #000066;">(</span>Filename<span style="color: #000066;">:</span> <span style="color: #000066; font-weight: bold;">string</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">var</span>
  Source<span style="color: #000066;">:</span> TFileStream<span style="color: #000066;">;</span>
  Thumb<span style="color: #000066;">:</span> TMemoryStream<span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">begin</span>
  Source<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TFileStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">(</span>Filename<span style="color: #000066;">,</span> fmOpenRead<span style="color: #000066;">)</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">try</span>
    Thumb<span style="color: #000066;">:</span><span style="color: #000066;">=</span> TMemoryStream<span style="color: #000066;">.</span><span style="color: #006600;">Create</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span>
      <span style="color: #000000; font-weight: bold;">if</span> ReadThumb<span style="color: #000066;">(</span>Source<span style="color: #000066;">,</span>Thumb<span style="color: #000066;">)</span> <span style="color: #000000; font-weight: bold;">then</span>
        Thumb<span style="color: #000066;">.</span><span style="color: #006600;">SaveToFile</span><span style="color: #000066;">(</span><span style="color: #000066;">ChangeFileExt</span><span style="color: #000066;">(</span>Filename<span style="color: #000066;">,</span><span style="color: #ff0000;">'_thumb.jpg'</span><span style="color: #000066;">)</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">finally</span>
      Thumb<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
    <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">finally</span>
    Source<span style="color: #000066;">.</span><span style="color: #006600;">Free</span><span style="color: #000066;">;</span>
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
<span style="color: #000000; font-weight: bold;">end</span><span style="color: #000066;">;</span>
 
<span style="color: #808080; font-style: italic;">// Por ejemplo</span>
  ExtractThumb<span style="color: #000066;">(</span><span style="color: #ff0000;">'D:\1.jpg'</span><span style="color: #000066;">)</span><span style="color: #000066;">;</span></pre></div>
<p>En el ejemplo anterior si "d:\1.jpg" contiene un imagen en miniatura, se guardara en el archivo "d:\1_thumb.jpg", y si no contienen ninguna no se crea ningún fichero. Ahora solo tenemos que buscar un directorio con un buen numero de jpegs y hacerlo con todas las imágenes para ver si descubrimos algo ...</p>
</div></div></div>    <footer>
        <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul>  </footer>
    <div id="comments" class="comment-wrapper">
          <h2 class="title">Comentarios</h2>
      
  <a id="comment-144"></a>
<div class="comment comment-by-anonymous clearfix" about="/comment/144#comment-144" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a style="display: none;" href="/comment/144#comment-144" class="permalink" rel="bookmark">¿y otros números mágicos para</a></h3>
  
  <div class="submitted">
    <a style="display: none;" href="/comment/144#comment-144" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2009-08-28T19:40:48+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" typeof="sioc:UserAccount" property="foaf:name" datatype="">José Miguel Ruíz (no verificado)</span> el Vie, 08/28/2009 - 19:40</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/10" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>¿y otros números mágicos para ficheros .png, .gif, jpeg2000, .bmp, etc ?</p>
<p>Thx</p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>

<div class="indented"><a id="comment-145"></a>
<div class="comment comment-by-node-author clearfix" about="/comment/145#comment-145" typeof="sioc:Post sioct:Comment">
  
  
    <h3 property="dc:title" datatype=""><a style="display: none;" href="/comment/145#comment-145" class="permalink" rel="bookmark">Los números FFD8 no son tan</a></h3>
  
  <div class="submitted">
    <a style="display: none;" href="/comment/145#comment-145" class="permalink" rel="bookmark">Enlace permanente</a>    <span property="dc:date dc:created" content="2009-08-28T21:11:00+02:00" datatype="xsd:dateTime" rel="sioc:has_creator">Enviado por <span class="username" xml:lang="" about="/user/1" typeof="sioc:UserAccount" property="foaf:name" datatype="">admin</span> el Vie, 08/28/2009 - 21:11</span>  </div>

  <div class="content">
    <span rel="sioc:reply_of" resource="/node/10" class="rdf-meta element-hidden"></span><span rel="sioc:reply_of" resource="/comment/144#comment-144" class="rdf-meta element-hidden"></span><div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Los números FFD8 no son tan "mágicos" simplemente es la marca con lo que empiezan todos los ficheros jpeg según las especificaciones de ese formato. Para otro tipo de ficheros habría que encontrar las especificaciones de ese formato, ver si existe algún tipo de marca reconocible (por ejemplo los bmp empiezan con los caracteres "BM"), y  luego encontrar la forma de leer los datos sin conocer de antemano el tamaño del fichero.</p>
<p>Para empezar puedes buscar las especificaciones en esta pagina:<br /><a href="http://www.wotsit.org/">http://www.wotsit.org/</a></p>
</div></div></div>      </div>

  <ul class="links list-inline"><li class="comment_forbidden first last"></li>
</ul></div>
</div>
  </div>
</article>

</section>
  </div>
    </section>

    
  </div>
</div>

  <script src="/sites/delphi.jmrds.com/themes/bootstrap/js/bootstrap.js?"></script>
</body>
</html>
